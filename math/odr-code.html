
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ODR - Code Examples &#8212; Quantopia&#39;:&#39; Physics, Python and Pi</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'math/odr-code';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Continuity Equation" href="../physics/continuity-equation-01.html" />
    <link rel="prev" title="Orthogonal Distance Regression" href="orthogonal-distance-regression.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Quantopia':' Physics, Python and Pi - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Quantopia':' Physics, Python and Pi - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Quantopia: Physics, Python, and Pi (Alpha Version)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">MATH</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gradient-operator.html">Gradient</a></li>
<li class="toctree-l1"><a class="reference internal" href="gradient-directional-derivative.html">Directional Derivative</a></li>
<li class="toctree-l1"><a class="reference internal" href="divergence.html">Divergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="fourier-transform-01.html">Fourier Transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainties-introduction.html">Experimental Errors and Significant Figures</a></li>
<li class="toctree-l1"><a class="reference internal" href="least-squares-regression.html">Least Squares Regression, RSS, RMSE, R-squared</a></li>
<li class="toctree-l1"><a class="reference internal" href="least-squares-regression-code.html">Least Squares Regression - Code Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="ordinary-least-squares.html">Ordinary Least Squares (OLS) Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="ordinary-least-squares-code.html">Ordinary Least Squares (OLS) Regression - Code Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="variance-covariance.html">Variance and Covariance</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted-least-squares.html">Weighted Least Squares</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted-least-squares-code-1.html">WLS - Code Examples Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted-least-squares-code-2.html">WLS - Code Examples Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="goodness-of-fit-and-chi-squared.html">Goodness of Fit and Chi-Squared Statistic</a></li>
<li class="toctree-l1"><a class="reference internal" href="aic-and-bic.html">Akaike Information Criterion (AIC) and Bayesian Information Criterion (BIC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted-least-squares-code-3.html">WLS - Code Examples Part 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="orthogonal-distance-regression.html">Orthogonal Distance Regression</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">ODR - Code Examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">PHYSICS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../physics/continuity-equation-01.html">The Continuity Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/continuity-equation-02.html">The Continuity Equation: One-Dimensional Advection of a Density Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/ensemble.html">Statistical Ensembles and Liouville’s Theorem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/microcanonical-ensemble.html">Microcanonical Ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/inertial_vs_gravitational_mass.html">Mass: Inertial vs. Gravitational</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/Yakovliev/quantopia/blob/main/book/math/odr-code.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Yakovliev/quantopia" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Yakovliev/quantopia/issues/new?title=Issue%20on%20page%20%2Fmath/odr-code.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/math/odr-code.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ODR - Code Examples</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-investigation-of-odr">General Investigation of ODR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inverse-condition-number">Inverse Condition Number</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reason-s-for-halting-sum-of-squares-convergence">Reason(s) for Halting: Sum of Squares Convergence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predicted-values-of-x-and-y">Predicted values of x and y</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-methods-for-odr-analysis">General Methods for ODR Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-of-methods-dataset-3">Usage of Methods. Dataset 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-of-methods-dataset-1">Usage of Methods. Dataset 1</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improved-model-function">Improved model function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-than-2-parameters-in-the-non-linear-model">More than 2 parameters in the non-linear model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-of-methods-dataset-2">Usage of Methods. Dataset 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-3">Code 3</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="odr-code-examples">
<h1>ODR - Code Examples<a class="headerlink" href="#odr-code-examples" title="Link to this heading">#</a></h1>
<section id="general-investigation-of-odr">
<h2>General Investigation of ODR<a class="headerlink" href="#general-investigation-of-odr" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.odr</span><span class="w"> </span><span class="kn">import</span> <span class="n">ODR</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">RealData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dataset 3</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">401</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">87.8</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mf">65.7</span><span class="p">,</span> <span class="mf">50.9</span><span class="p">,</span> <span class="mf">46.5</span><span class="p">,</span> <span class="mf">44.4</span><span class="p">])</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the ODR model and data</span>
<span class="n">odr_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">model_function</span><span class="p">)</span>
<span class="n">odr_data</span> <span class="o">=</span> <span class="n">RealData</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">)</span>

<span class="c1"># Instantiate and run the ODR fit</span>
<span class="n">odr_instance</span> <span class="o">=</span> <span class="n">ODR</span><span class="p">(</span><span class="n">odr_data</span><span class="p">,</span> <span class="n">odr_model</span><span class="p">,</span> <span class="n">beta0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">odr_instance</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Beta: [5.67694275e+01 9.88335260e-03]
Beta Std Error: [4.26741666e-01 2.63972932e-04]
Beta Covariance: [[ 2.41744445e-01 -1.18588964e-04]
 [-1.18588964e-04  9.25007382e-08]]
Residual Variance: 0.7533097575791786
Inverse Condition #: 0.17698951436366908
Reason(s) for Halting:
  Sum of squares convergence
</pre></div>
</div>
</div>
</div>
<section id="inverse-condition-number">
<h3>Inverse Condition Number<a class="headerlink" href="#inverse-condition-number" title="Link to this heading">#</a></h3>
<p>The “Inverse Condition #” is the reciprocal (1/x) of the condition number. The condition number itself is a measure of how sensitive the solution (the estimated parameters of your model) is to changes in the input data.</p>
<ul class="simple">
<li><p><strong>A large Inverse Condition Number (close to 1)</strong> indicates a well-conditioned problem. This is desirable and suggests that small changes in your input data will only cause small changes in the estimated parameters.</p>
<ul>
<li><p>Our result of approximately 0.177 is in a moderate range - it’s not ideal (e.g., &gt;0.5 would be better for high precision), but it’s far from problematic levels (e.g., &lt;0.01), especially for a small dataset like ours. No major numerical instability is indicated here, and the fit should be reliable for practical purposes (for practical purposes, as long as inverse condition number isn’t extremely close to zero, it’s generally acceptable).</p></li>
</ul>
</li>
<li><p><strong>A small Inverse Condition Number (close to 0)</strong> points to an ill-conditioned problem. In such cases, minor variations in the input data could lead to significant changes in the determined parameters, making the solution less reliable.</p></li>
</ul>
<p>In essence, this number helps you gauge the numerical stability and reliability of the parameter estimates provided by the Orthogonal Distance Regression (ODR) fit.</p>
</section>
<section id="reason-s-for-halting-sum-of-squares-convergence">
<h3>Reason(s) for Halting: Sum of Squares Convergence<a class="headerlink" href="#reason-s-for-halting-sum-of-squares-convergence" title="Link to this heading">#</a></h3>
<p>This indicates why the iterative fitting process stopped. The ODR algorithm works by iteratively adjusting the parameters (<code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> in your model) to minimize the sum of the squared weighted orthogonal distances from the data points to the fitted curve.</p>
<p>“Sum of squares convergence” means that the algorithm terminated because the improvements in the sum of squared residuals from one iteration to the next became negligibly small. This is a standard and successful stopping criterion for such optimization routines. It implies that the algorithm has found a stable solution where further adjustments to the parameters do not significantly improve the fit to the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_params</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">beta</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fitted parameters (output.beta): </span><span class="si">{</span><span class="n">fit_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">sd_beta</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sd_beta</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard deviations of the parameters (output.sd_beta): </span><span class="si">{</span><span class="n">sd_beta</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">sd_beta_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">cov_beta</span> <span class="o">*</span> <span class="n">output</span><span class="o">.</span><span class="n">res_var</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard deviations of the parameters (alternative calculation using cov_beta): </span><span class="si">{</span><span class="n">sd_beta_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">inv_cond_num</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">inv_condnum</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inverse condition number (output.inv_condnum): </span><span class="si">{</span><span class="n">inv_cond_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fitted parameters (output.beta): [5.67694275e+01 9.88335260e-03]
Standard deviations of the parameters (output.sd_beta): [4.26741666e-01 2.63972932e-04]
Standard deviations of the parameters (alternative calculation using cov_beta): [4.26741666e-01 2.63972932e-04]
Inverse condition number (output.inv_condnum): 0.17698951436366908
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Store the original data in the results dictionary for plotting later</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_obs</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_sigma_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_x</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_sigma_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_y</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_weights_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_weights_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Store results from ODR&#39;s Output object</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;odr_output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">beta</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_errs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sd_beta</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;cov_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">cov_beta</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_observations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_observations&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;inverse_condition_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">inv_condnum</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_values</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_errs&#39;</span><span class="p">]</span>
<span class="n">p_values</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_values</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_values</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;p_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_values</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;t-values: </span><span class="si">{</span><span class="n">t_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-values: </span><span class="si">{</span><span class="n">p_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t-values: [133.02996178  37.44078054]
p-values: [4.55295786e-10 2.56015184e-07]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_x</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">delta</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;delta_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">delta_x</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Array of estimated errors in input variables, of same shape as x (output.delta):</span><span class="se">\n</span><span class="si">{</span><span class="n">delta_x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">epsilon_y</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">eps</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;epsilon_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsilon_y</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Array of estimated errors in response variables, of same shape as y (output.eps):</span><span class="se">\n</span><span class="si">{</span><span class="n">epsilon_y</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array of estimated errors in input variables, of same shape as x (output.delta):
[ 0.          1.12128483  1.00051757 -1.82517415  0.59658578 -0.05011438
 -0.01544762]
Array of estimated errors in response variables, of same shape as y (output.eps):
[ 0.          0.15853071  0.18633185 -0.52598787  0.46385468 -0.09998956
 -0.09054455]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">xplus</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;x_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">xplus</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Array of predicted x values (output.xplus):</span><span class="se">\n</span><span class="si">{</span><span class="n">x_pred</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">x_pred_2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">delta</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Array of predicted x values (x + output.delta):</span><span class="se">\n</span><span class="si">{</span><span class="n">x_pred_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">y</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">y</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Array of predicted y values (output.y):</span><span class="se">\n</span><span class="si">{</span><span class="n">y_pred</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">y_pred_2</span> <span class="o">=</span> <span class="n">model_function</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">],</span> <span class="n">x</span> <span class="o">+</span> <span class="n">delta_x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Array of predicted y values (model_function with (x + delta_x) argument):</span><span class="se">\n</span><span class="si">{</span><span class="n">y_pred_2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array of predicted x values (output.xplus):
[  0.          24.12128483  52.00051757  96.17482585 196.59658578
 291.94988562 400.98455238]
Array of predicted x values (x + output.delta):
[  0.          24.12128483  52.00051757  96.17482585 196.59658578
 291.94988562 400.98455238]

Array of predicted y values (output.y):
[100.          87.95853071  77.18633185  65.17401213  51.36385468
  46.40001044  44.30945545]
Array of predicted y values (model_function with (x + delta_x) argument):
[100.          87.95853071  77.18633185  65.17401213  51.36385468
  46.40001044  44.30945545]
</pre></div>
</div>
</div>
</div>
</section>
<section id="predicted-values-of-x-and-y">
<h3>Predicted values of x and y<a class="headerlink" href="#predicted-values-of-x-and-y" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">output.xplus</span></code> represents the “predicted” or adjusted x-values. These are computed as the original <code class="docutils literal notranslate"><span class="pre">x</span></code> plus the estimated errors/adjustments in the input variables (<code class="docutils literal notranslate"><span class="pre">output.delta</span></code>), i.e., <code class="docutils literal notranslate"><span class="pre">xplus</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">delta</span></code>. They correspond to the x-coordinates on the fitted curve that are closest (in an orthogonal sense) to each observed data point <code class="docutils literal notranslate"><span class="pre">(x[i],</span> <span class="pre">y_obs[i])</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output.y</span></code> represents the predicted y-values, which are the model’s evaluations at those adjusted x-values: <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">model_function(beta,</span> <span class="pre">xplus)</span></code>. These are the y-coordinates on the fitted curve corresponding to the same closest points.</p></li>
</ul>
<p>Together, the pairs <code class="docutils literal notranslate"><span class="pre">(output.xplus[i],</span> <span class="pre">output.y[i])</span></code> are the projections (feet of the perpendiculars) of our observed data points onto the fitted curve. This differs from ordinary least squares regression (where errors are assumed only in y, and predictions are simply <code class="docutils literal notranslate"><span class="pre">model_function(beta,</span> <span class="pre">x)</span></code> at the original x-values). In ODR, since errors are considered in both x and y, these adjusted predictions account for uncertainties in both directions, minimizing the orthogonal distances.</p>
<p>Our code already demonstrates this equivalence with the alternative calculations:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x_pred_2</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">output.delta</span></code> matches <code class="docutils literal notranslate"><span class="pre">output.xplus</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y_pred_2</span> <span class="pre">=</span> <span class="pre">model_function(fit_params,</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">delta_x)</span></code> matches <code class="docutils literal notranslate"><span class="pre">output.y</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sum_square_delta</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sum_square_delta</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sum of squares of delta error (output.sum_square_delta): </span><span class="si">{</span><span class="n">sum_square_delta</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">delta_errors</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">delta</span>
<span class="n">manual_sum_square_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">delta_errors</span> <span class="o">/</span> <span class="n">sigma_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manually calculated sum_square_delta: </span><span class="si">{</span><span class="n">manual_sum_square_delta</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">sum_square_eps</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sum_square_eps</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sum of squares of epsilon error (output.sum_square_eps): </span><span class="si">{</span><span class="n">sum_square_eps</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">epsilon_errors</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">eps</span>
<span class="n">manual_sum_square_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">epsilon_errors</span> <span class="o">/</span> <span class="n">sigma_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manually calculated sum_square_eps: </span><span class="si">{</span><span class="n">manual_sum_square_eps</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sum of squares of delta error (output.sum_square_delta): 1.4871
Manually calculated sum_square_delta: 1.4871

Sum of squares of epsilon error (output.sum_square_eps): 2.2795
Manually calculated sum_square_eps: 2.2795
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sum_square</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sum_square</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;chi_squared_odr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sum_square</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi-squared (output.sum_square): </span><span class="si">{</span><span class="n">sum_square</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">res_var</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">res_var</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;reduced_chi_squared_odr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">res_var</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced Chi-squared (output.res_var): </span><span class="si">{</span><span class="n">res_var</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calculate Chi-Squared manually as per the formula</span>
<span class="c1"># ODR output provides delta (residuals in x) and eps (residuals in y)</span>
<span class="n">chi_squared_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">output</span><span class="o">.</span><span class="n">delta</span> <span class="o">/</span> <span class="n">sigma_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">eps</span> <span class="o">/</span> <span class="n">sigma_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;chi_squared_manual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi_squared_manual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi-squared (manual calculation): </span><span class="si">{</span><span class="n">chi_squared_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Reduced Chi-Squared (manual calculation)</span>
<span class="n">reduced_chi_squared_manual</span> <span class="o">=</span> <span class="n">chi_squared_manual</span> <span class="o">/</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">]</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;reduced_chi_squared_manual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reduced_chi_squared_manual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced Chi-squared (manual calculation): </span><span class="si">{</span><span class="n">reduced_chi_squared_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chi-squared (output.sum_square): 3.7665
Reduced Chi-squared (output.res_var): 0.7533
Chi-squared (manual calculation): 3.7665
Reduced Chi-squared (manual calculation): 0.7533
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Information Criteria (using the log-likelihood for ODR, which is implicitly</span>
<span class="c1"># based on the chi-squared statistic, assuming a Gaussian error model).</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_observations&#39;</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]</span>

<span class="c1"># A log-likelihood for ODR, based on the chi-squared value.</span>
<span class="n">llf</span> <span class="o">=</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma_y</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;chi_squared_odr&#39;</span><span class="p">]</span>

<span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span>
<span class="n">bic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<span class="n">aicc</span> <span class="o">=</span> <span class="n">aic</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">results</span><span class="p">[</span><span class="s1">&#39;log_likelihood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">llf</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aic</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bic</span>
<span class="n">results</span><span class="p">[</span><span class="s1">&#39;aicc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aicc</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Maximum Log-Likelihood:&#39;</span><span class="p">,</span> <span class="n">llf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AIC:&#39;</span><span class="p">,</span> <span class="n">aic</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;BIC:&#39;</span><span class="p">,</span> <span class="n">bic</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AICC:&#39;</span><span class="p">,</span> <span class="n">aicc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Maximum Log-Likelihood: -14.748413858813365
AIC: 33.49682771762673
BIC: 33.38864801573735
AICC: 36.49682771762673
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="general-methods-for-odr-analysis">
<h2>General Methods for ODR Analysis<a class="headerlink" href="#general-methods-for-odr-analysis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.odr</span><span class="w"> </span><span class="kn">import</span> <span class="n">ODR</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">RealData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tabulate</span><span class="w"> </span><span class="kn">import</span> <span class="n">tabulate</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs an Orthogonal Distance Regression (ODR) curve fit and calculates</span>
<span class="sd">    various goodness-of-fit and error metrics.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (np.array): The independent variable data.</span>
<span class="sd">        y_obs (np.array): The observed dependent variable data.</span>
<span class="sd">        sigma_x (np.array): The standard deviations of the x points.</span>
<span class="sd">        sigma_y (np.array): The standard deviations of the y_obs points.</span>
<span class="sd">        function (callable): The function to fit to the data.</span>
<span class="sd">        initial_guess (list): The initial guess for the function parameters.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing all the calculated results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Define the ODR model and data</span>
    <span class="n">odr_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="n">odr_data</span> <span class="o">=</span> <span class="n">RealData</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">)</span>

    <span class="c1"># Instantiate and run the ODR fit</span>
    <span class="n">odr_instance</span> <span class="o">=</span> <span class="n">ODR</span><span class="p">(</span><span class="n">odr_data</span><span class="p">,</span> <span class="n">odr_model</span><span class="p">,</span> <span class="n">beta0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">odr_instance</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="c1"># Store the original data in the results dictionary for plotting later</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_obs</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_sigma_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_x</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_sigma_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_y</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_weights_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_weights_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># Store results from ODR&#39;s Output object</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;odr_output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">beta</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_errs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sd_beta</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;cov_beta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">cov_beta</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_observations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_observations&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;inverse_condition_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">inv_condnum</span>

    <span class="c1"># Calculate t-values and p-values</span>
    <span class="n">t_values</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_errs&#39;</span><span class="p">]</span>
    <span class="n">p_values</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_values</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_values</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;p_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_values</span>

    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;delta_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">delta</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;epsilon_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">eps</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;x_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">xplus</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">y</span>

    <span class="c1"># Chi-Squared and Reduced Chi-Squared from ODR output</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;chi_squared_odr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">sum_square</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;reduced_chi_squared_odr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">res_var</span>

    <span class="c1"># Information Criteria (using the log-likelihood for ODR, which is implicitly</span>
    <span class="c1"># based on the chi-squared statistic, assuming a Gaussian error model).</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_observations&#39;</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]</span>

    <span class="c1"># A log-likelihood for ODR, based on the chi-squared value.</span>
    <span class="n">llf</span> <span class="o">=</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma_y</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;chi_squared_odr&#39;</span><span class="p">]</span>

    <span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span>
    <span class="n">bic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
    <span class="n">aicc</span> <span class="o">=</span> <span class="n">aic</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;log_likelihood&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">llf</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aic</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bic</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;aicc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aicc</span>

    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">print_metrics</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the calculated metrics from the results dictionary for ODR.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;odr_output&#39;</span><span class="p">]</span>
    <span class="n">fit_params</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>
    <span class="n">std_errs</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_errs&#39;</span><span class="p">]</span>
    <span class="n">t_values</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;t_values&#39;</span><span class="p">]</span>
    <span class="n">p_values</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;p_values&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_observations&#39;</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;number_of_parameters&#39;</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- ODR Fit Results ---&quot;</span><span class="p">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Summary of Results ---&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">fit_params</span><span class="p">,</span> <span class="n">std_errs</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter </span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">param</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">err</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  T-value: </span><span class="si">{</span><span class="n">t_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">, P-value: </span><span class="si">{</span><span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Model Fit Statistics ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Number of Observations (n): </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Parameters (p): </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of Freedom (n-p): </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Goodness-of-Fit &amp; Error Metrics ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi-Squared (from ODR): </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;chi_squared_odr&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced Chi-Squared (from ODR): </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;reduced_chi_squared_odr&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Information Criteria ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum Log-Likelihood: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;log_likelihood&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC (Akaike Information Criterion): </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;aic&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC (Bayesian Information Criterion): </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;bic&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AICc (Corrected AIC): </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;aicc&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Comparison of Original and Predicted Data Points ---&quot;</span><span class="p">)</span>
    
    <span class="c1"># Unpack data points</span>
    <span class="n">x_orig</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_x&#39;</span><span class="p">]</span>
    <span class="n">y_orig</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_y&#39;</span><span class="p">]</span>
    <span class="n">x_pred</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;x_pred&#39;</span><span class="p">]</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span>

    <span class="c1"># Prepare data for the table</span>
    <span class="n">comparison_data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">x_pred</span><span class="p">,</span> <span class="n">y_orig</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">comp_headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Original X&quot;</span><span class="p">,</span> <span class="s2">&quot;Predicted X (x_plus)&quot;</span><span class="p">,</span> <span class="s2">&quot;Original Y&quot;</span><span class="p">,</span> <span class="s2">&quot;Predicted Y (fit)&quot;</span><span class="p">]</span>

    <span class="c1"># Print the formatted table</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">comparison_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">comp_headers</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;.4f&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">draw_curve_fit</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes the ODR fit with a 95% confidence band.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (dict): The dictionary returned by the analyze_odr function.</span>
<span class="sd">        model_function (callable): The model function used for the fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- 1. Unpack data from the results dictionary ---</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_x&quot;</span><span class="p">]</span>
    <span class="n">y_data</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_y&quot;</span><span class="p">]</span>
    <span class="n">sigma_x</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_sigma_x&quot;</span><span class="p">]</span>
    <span class="n">sigma_y</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_sigma_y&quot;</span><span class="p">]</span>
    <span class="n">popt</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>
    <span class="n">perr</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_errs&#39;</span><span class="p">]</span>
    <span class="n">cov_beta</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;cov_beta&#39;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;degrees_of_freedom&#39;</span><span class="p">]</span>
    
    <span class="c1"># --- 2. Set up the plot ---</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>

    <span class="c1"># --- 3. Plot the curve fit ---</span>
    
    <span class="c1"># Plot original data with error bars</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> 
        <span class="n">xerr</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span> 
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Data&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>

    <span class="c1"># Generate points for the fitted curve and confidence band</span>
    <span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
    <span class="n">y_plot</span> <span class="o">=</span> <span class="n">model_function</span><span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="n">x_plot</span><span class="p">)</span>
    
    <span class="c1"># --- 4. Calculate and plot the 95% confidence band ---</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">jacobian</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
        <span class="c1"># Partial derivatives of the model function w.r.t. parameters A and B</span>
        <span class="n">d_dA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">d_dB</span> <span class="o">=</span> <span class="o">-</span><span class="n">A</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d_dA</span><span class="p">,</span> <span class="n">d_dB</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        
    <span class="n">J</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="n">x_plot</span><span class="p">)</span>
    <span class="c1"># Variance of the predicted y values</span>
    <span class="n">var_y_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">J</span> <span class="o">@</span> <span class="n">cov_beta</span> <span class="o">*</span> <span class="n">J</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Standard error of the predicted y values</span>
    <span class="n">se_y_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var_y_plot</span><span class="p">)</span>
    
    <span class="c1"># Get the critical t-value for 95% confidence</span>
    <span class="n">t_val</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># Confidence interval half-width</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="n">t_val</span> <span class="o">*</span> <span class="n">se_y_plot</span>
    
    <span class="c1"># Plot the confidence band</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">x_plot</span><span class="p">,</span> <span class="n">y_plot</span> <span class="o">-</span> <span class="n">ci</span><span class="p">,</span> <span class="n">y_plot</span> <span class="o">+</span> <span class="n">ci</span><span class="p">,</span> 
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;95% Confidence Band&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Plot the fitted curve</span>
    <span class="n">label_text</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;ODR Fitted Curve</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;A=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;B=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_text</span><span class="p">)</span>

    <span class="c1"># --- 5. Configure title, labels, and final layout ---</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Orthogonal Distance Regression (ODR) Fit</span><span class="se">\n</span><span class="s2">Reduced $</span><span class="se">\\</span><span class="s2">chi^2$ = </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;reduced_chi_squared_odr&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X-Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y-Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates scatter plots to compare observed vs. predicted values for x and y,</span>
<span class="sd">    with an option to display error bars for both observed and predicted values.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (dict): The dictionary returned by the analyze_odr function.</span>
<span class="sd">        show_errors (bool): If True, displays error bars on the plots. </span>
<span class="sd">                            The results dict must contain &#39;sd_xplus&#39; and &#39;sd_y&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- 1. Unpack the required data from the results dictionary ---</span>
    <span class="n">x_obs</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_x&#39;</span><span class="p">]</span>
    <span class="n">y_obs</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;original_y&#39;</span><span class="p">]</span>
    <span class="n">x_pred</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;x_pred&#39;</span><span class="p">]</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span>

    <span class="c1"># --- 2. Set up the figure with two subplots ---</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
    
    <span class="c1"># --- 3. First subplot: Observed X vs. Predicted X ---</span>
    <span class="k">if</span> <span class="n">show_errors</span><span class="p">:</span>
        <span class="n">sigma_x</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_sigma_x&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sigma_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: &#39;original_sigma_x&#39; not in results. Cannot plot predicted X errors.&quot;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">x_pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Points&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">x_obs</span><span class="p">,</span> <span class="n">x_pred</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span>
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Points&#39;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">x_pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Points&#39;</span><span class="p">)</span>

    <span class="c1"># Create the line of identity (y=x)</span>
    <span class="n">lims_x</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">min</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_pred</span><span class="p">)),</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_pred</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lims_x</span><span class="p">,</span> <span class="n">lims_x</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Identity Line&#39;</span><span class="p">)</span>
    
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Predicted X vs. Observed X&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Observed X Values (with measurement error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted X Values (with prediction error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="c1"># --- 4. Second subplot: Observed Y vs. Predicted Y ---</span>
    <span class="k">if</span> <span class="n">show_errors</span><span class="p">:</span>
        <span class="n">sigma_y</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_sigma_y&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sigma_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: &#39;original_sigma_y&#39; not in results. Cannot plot predicted Y errors.&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Points&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
                <span class="n">y_obs</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span>
                <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Points&#39;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Points&#39;</span><span class="p">)</span>
    
    <span class="c1"># Create the line of identity</span>
    <span class="n">lims_y</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nb">min</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_obs</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)),</span>
        <span class="nb">max</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_obs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lims_y</span><span class="p">,</span> <span class="n">lims_y</span><span class="p">,</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Identity Line&#39;</span><span class="p">)</span>
    
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Predicted Y vs. Observed Y&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Observed Y Values (with measurement error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Predicted Y Values (with prediction error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;box&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    
    <span class="c1"># --- 5. Final adjustments and display ---</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Comparison of Observed and ODR-Predicted Values&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="usage-of-methods-dataset-3">
<h2>Usage of Methods. Dataset 3<a class="headerlink" href="#usage-of-methods-dataset-3" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 3</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">401</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">87.8</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mf">65.7</span><span class="p">,</span> <span class="mf">50.9</span><span class="p">,</span> <span class="mf">46.5</span><span class="p">,</span> <span class="mf">44.4</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># sigma_x = np.full_like(x, 2.0, dtype=float)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [5.67471826e+01 9.91153159e-03]
Beta Std Error: [3.73741090e-01 2.58479394e-04]
Beta Covariance: [[ 2.68145384e-01 -1.48447716e-04]
 [-1.48447716e-04  1.28256824e-07]]
Residual Variance: 0.520920405677155
Inverse Condition #: 0.15743721227613128
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 56.74718 +/- 0.37374
  T-value: 151.83554632, P-value: 0.00000000
Parameter B: 0.00991 +/- 0.00026
  T-value: 38.34553867, P-value: 0.00000023

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 2
Degrees of Freedom (n-p): 5

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 2.6046
Reduced Chi-Squared (from ODR): 0.5209

--- Information Criteria ---
Maximum Log-Likelihood: -17.0057
AIC (Akaike Information Criterion): 38.0114
BIC (Bayesian Information Criterion): 37.9032
AICc (Corrected AIC): 41.0114

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
     23.0000                 24.2449       87.8000              87.8782
     51.0000                 52.1504       77.0000              77.0953
     98.0000                 95.1882       65.7000              65.3433
    196.0000                197.1337       50.9000              51.2951
    292.0000                291.8845       46.5000              46.3971
    401.0000                400.9693       44.4000              44.3193
</pre></div>
</div>
<img alt="../_images/2d017049566f52270efaf971113736f7bd4f54096455a21364a5a16b5b6f02bb.png" src="../_images/2d017049566f52270efaf971113736f7bd4f54096455a21364a5a16b5b6f02bb.png" />
<img alt="../_images/059c217b88c368f80f37ecb33c7d3ca1cd6f177e927cce7fa79b3dc503e7003d.png" src="../_images/059c217b88c368f80f37ecb33c7d3ca1cd6f177e927cce7fa79b3dc503e7003d.png" />
</div>
</div>
</section>
<section id="usage-of-methods-dataset-1">
<h2>Usage of Methods. Dataset 1<a class="headerlink" href="#usage-of-methods-dataset-1" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">79.7</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [1.00575020e+02 2.26572259e-02]
Beta Std Error: [3.44395956e+00 2.13548845e-03]
Beta Covariance: [[ 3.79384260e+00 -2.19447013e-03]
 [-2.19447013e-03  1.45867210e-06]]
Residual Variance: 3.126344114120784
Inverse Condition #: 0.09653487400105343
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 100.57502 +/- 3.44396
  T-value: 29.20331044, P-value: 0.00000088
Parameter B: 0.02266 +/- 0.00214
  T-value: 10.60985645, P-value: 0.00012861

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 2
Degrees of Freedom (n-p): 5

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 15.6317
Reduced Chi-Squared (from ODR): 3.1263

--- Information Criteria ---
Maximum Log-Likelihood: -20.6810
AIC (Akaike Information Criterion): 45.3620
BIC (Bayesian Information Criterion): 45.2538
AICc (Corrected AIC): 48.3620

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
      5.0000                  9.8588       79.7000              79.8666
     25.0000                 29.0394       51.3000              51.5139
     34.0000                 35.2503       44.6000              44.6762
     42.0000                 40.4024       39.8000              39.6906
     57.0000                 53.2045       29.9000              29.5525
     97.0000                 97.5863       10.3000              10.4467
</pre></div>
</div>
<img alt="../_images/6517a316da2ca14b0ea5598cc1450269fa1ba0ee00880196e435620b85122723.png" src="../_images/6517a316da2ca14b0ea5598cc1450269fa1ba0ee00880196e435620b85122723.png" />
<img alt="../_images/aeb2999b2e4f6b8a6f145480f8d772e2c0680833acd410e4cb70e2286ace3463.png" src="../_images/aeb2999b2e4f6b8a6f145480f8d772e2c0680833acd410e4cb70e2286ace3463.png" />
</div>
</div>
<p>NOTE: Second point in the dataset 1 looks like an outlier. Let’s try to get rid of it and see what happends</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [1.01238423e+02 2.21835073e-02]
Beta Std Error: [3.17336235e+00 1.87352093e-03]
Beta Covariance: [[ 4.26076480e+00 -2.35925733e-03]
 [-2.35925733e-03  1.48513294e-06]]
Residual Variance: 2.3634791135669273
Inverse Condition #: 0.09638301867431867
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 101.23842 +/- 3.17336
  T-value: 31.90257270, P-value: 0.00000575
Parameter B: 0.02218 +/- 0.00187
  T-value: 11.84054418, P-value: 0.00029127

--- Model Fit Statistics ---

Number of Observations (n): 6
Number of Parameters (p): 2
Degrees of Freedom (n-p): 4

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 9.4539
Reduced Chi-Squared (from ODR): 2.3635

--- Information Criteria ---
Maximum Log-Likelihood: -15.7542
AIC (Akaike Information Criterion): 35.5084
BIC (Bayesian Information Criterion): 35.0920
AICc (Corrected AIC): 39.5084

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
     25.0000                 29.3688       51.3000              51.5332
     34.0000                 35.6206       44.6000              44.6994
     42.0000                 40.7956       39.8000              39.7171
     57.0000                 53.6012       29.9000              29.5894
     97.0000                 97.4646       10.3000              10.4123
</pre></div>
</div>
<img alt="../_images/a229565e2916a61160644a43472bf6c67d99d55553b1aadc94b0e327fcd15257.png" src="../_images/a229565e2916a61160644a43472bf6c67d99d55553b1aadc94b0e327fcd15257.png" />
<img alt="../_images/7fd0660f65aaf63781e271568bf2375b473c83b5d3bd3006ae626db48ba14dbb.png" src="../_images/7fd0660f65aaf63781e271568bf2375b473c83b5d3bd3006ae626db48ba14dbb.png" />
</div>
</div>
<p>This is an interesting result. Reduced <span class="math notranslate nohighlight">\(\chi^2\)</span> is lower than before. Also, <code class="docutils literal notranslate"><span class="pre">A</span></code> value is greater than 100, which means that at some specific x-value, the function can reach zero y-value, which will be an important result for us.</p>
<p>Let’s increase <code class="docutils literal notranslate"><span class="pre">sigma_x</span></code> from 2.0 to 3.0</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [1.01416469e+02 2.20950319e-02]
Beta Std Error: [2.98965533e+00 1.82309451e-03]
Beta Covariance: [[ 8.14786441e+00 -4.68628407e-03]
 [-4.68628407e-03  3.02984153e-06]]
Residual Variance: 1.0969793452965853
Inverse Condition #: 0.08953668330298414
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 101.41647 +/- 2.98966
  T-value: 33.92246188, P-value: 0.00000450
Parameter B: 0.02210 +/- 0.00182
  T-value: 12.11952087, P-value: 0.00026592

--- Model Fit Statistics ---

Number of Observations (n): 6
Number of Parameters (p): 2
Degrees of Freedom (n-p): 4

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 4.3879
Reduced Chi-Squared (from ODR): 1.0970

--- Information Criteria ---
Maximum Log-Likelihood: -15.6540
AIC (Akaike Information Criterion): 35.3080
BIC (Bayesian Information Criterion): 34.8915
AICc (Corrected AIC): 39.3080

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
     25.0000                 29.5211       51.3000              51.4076
     34.0000                 35.7192       44.6000              44.6469
     42.0000                 40.7917       39.8000              39.7631
     57.0000                 53.3942       29.9000              29.7546
     97.0000                 97.4816       10.3000              10.3514
</pre></div>
</div>
<img alt="../_images/f9fb8f7db779cbada4a9bca05ca34142d182d071ac5ef19380920ed1beae89a7.png" src="../_images/f9fb8f7db779cbada4a9bca05ca34142d182d071ac5ef19380920ed1beae89a7.png" />
<img alt="../_images/f79cd7199536752d05398c894ef76c07003e02e38b9248931f450ba148cef187.png" src="../_images/f79cd7199536752d05398c894ef76c07003e02e38b9248931f450ba148cef187.png" />
</div>
</div>
<p>This is also an interesting result. Reduced <span class="math notranslate nohighlight">\(\chi^2\)</span> is lower and close to 1.0 which is very good. <code class="docutils literal notranslate"><span class="pre">A</span></code> value remains to be greater than 100, which means that at some specific x-value, the function can reach zero y-value, which will be an important result for us.</p>
<section id="improved-model-function">
<h3>Improved model function<a class="headerlink" href="#improved-model-function" title="Link to this heading">#</a></h3>
<p>Let’s start from scratch and try to connect to the results from Dataset 3, so our function will be</p>
<div class="math notranslate nohighlight">
\[f(x, A, B) = A_1 (\exp (-B_1 x) - 1) + A (\exp(-B x) - 1) + 100 \]</div>
<p>where A_1 and B_1 are defined from the ODR of Dataset 3 using a function <span class="math notranslate nohighlight">\(f(x, A, B) = A (\exp(-B x) - 1) + 100 \)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x, A, B) = A_1 * (np.exp(-B_1 * x) - 1) + A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">A_1</span> <span class="o">=</span> <span class="mf">56.769</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="n">B_1</span> <span class="o">=</span> <span class="mf">0.00988</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="c1"># A_1 = 56.747 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>
    <span class="c1"># B_1 = 0.00991 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>

    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">79.7</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [5.64837483e+01 3.34000206e-02]
Beta Std Error: [1.85220408 0.00404159]
Beta Covariance: [[ 1.37387692e+00 -2.48458954e-03]
 [-2.48458954e-03  6.54144342e-06]]
Residual Variance: 2.497064990325722
Inverse Condition #: 0.04982581594705908
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 56.48375 +/- 1.85220
  T-value: 30.49542373, P-value: 0.00000071
Parameter B: 0.03340 +/- 0.00404
  T-value: 8.26408960, P-value: 0.00042316

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 2
Degrees of Freedom (n-p): 5

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 12.4853
Reduced Chi-Squared (from ODR): 2.4971

--- Information Criteria ---
Maximum Log-Likelihood: -19.1078
AIC (Akaike Information Criterion): 42.2156
BIC (Bayesian Information Criterion): 42.1074
AICc (Corrected AIC): 45.2156

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
      5.0000                  9.3481       79.7000              79.8436
     25.0000                 28.4156       51.3000              51.4850
     34.0000                 34.8140       44.6000              44.6515
     42.0000                 40.1873       39.8000              39.6698
     57.0000                 53.6460       29.9000              29.5748
     97.0000                 97.8532       10.3000              10.4870
</pre></div>
</div>
<img alt="../_images/8a819174c93580380886aaac2b38a24d6740d01b14838f39a062148f83dcf9b3.png" src="../_images/8a819174c93580380886aaac2b38a24d6740d01b14838f39a062148f83dcf9b3.png" />
<img alt="../_images/e6bae6820b511f32b716245c61e8f18fc673ee53800122cee73b54471ff52440.png" src="../_images/e6bae6820b511f32b716245c61e8f18fc673ee53800122cee73b54471ff52440.png" />
</div>
</div>
<p>After changing the model function, we obtained reduced <span class="math notranslate nohighlight">\(\chi^2\)</span> value which is close to the case where we used previous model function and excluded second point as outlier.</p>
<p>Let’s increase the value of <code class="docutils literal notranslate"><span class="pre">sigma_x</span></code> from 2.0 to 3.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x, A, B) = A_1 * (np.exp(-B_1 * x) - 1) + A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">A_1</span> <span class="o">=</span> <span class="mf">56.769</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="n">B_1</span> <span class="o">=</span> <span class="mf">0.00988</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="c1"># A_1 = 56.747 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>
    <span class="c1"># B_1 = 0.00991 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>

    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">79.7</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [5.66455646e+01 3.31064937e-02]
Beta Std Error: [1.70869523 0.00388607]
Beta Covariance: [[ 2.52930312e+00 -4.76804323e-03]
 [-4.76804323e-03  1.30825979e-05]]
Residual Variance: 1.1543256178977583
Inverse Condition #: 0.04785494385177525
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 56.64556 +/- 1.70870
  T-value: 33.15135640, P-value: 0.00000047
Parameter B: 0.03311 +/- 0.00389
  T-value: 8.51926296, P-value: 0.00036663

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 2
Degrees of Freedom (n-p): 5

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 5.7716
Reduced Chi-Squared (from ODR): 1.1543

--- Information Criteria ---
Maximum Log-Likelihood: -18.5892
AIC (Akaike Information Criterion): 41.1784
BIC (Bayesian Information Criterion): 41.0702
AICc (Corrected AIC): 44.1784

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
      5.0000                  9.4270       79.7000              79.7653
     25.0000                 28.5745       51.3000              51.3863
     34.0000                 34.9116       44.6000              44.6256
     42.0000                 40.1690       39.8000              39.7418
     57.0000                 53.4045       29.9000              29.7466
     97.0000                 97.8832       10.3000              10.3856
</pre></div>
</div>
<img alt="../_images/ebfbddafe63fe3a6ad8498548955c066252892a3f7f1cad5f4dd43bd59b53a4c.png" src="../_images/ebfbddafe63fe3a6ad8498548955c066252892a3f7f1cad5f4dd43bd59b53a4c.png" />
<img alt="../_images/1014d4468c2aef14ebfb6e6668550405d96848c56fdce05f6971a63d9989d746.png" src="../_images/1014d4468c2aef14ebfb6e6668550405d96848c56fdce05f6971a63d9989d746.png" />
</div>
</div>
<p>Reduced <span class="math notranslate nohighlight">\(\chi^2\)</span> is close to 1 which is pretty good.</p>
<p>Let’s exclude the second point from the dataset as outlier and validate the results with <code class="docutils literal notranslate"><span class="pre">sigma_x</span></code> = 2.0 and 3.0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x, A, B) = A_1 * (np.exp(-B_1 * x) - 1) + A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">A_1</span> <span class="o">=</span> <span class="mf">56.769</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="n">B_1</span> <span class="o">=</span> <span class="mf">0.00988</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="c1"># A_1 = 56.747 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>
    <span class="c1"># B_1 = 0.00991 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>

    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [5.68529058e+01 3.23008191e-02]
Beta Std Error: [1.70828296 0.00349095]
Beta Covariance: [[ 1.55965136e+00 -2.69324851e-03]
 [-2.69324851e-03  6.51321145e-06]]
Residual Variance: 1.8710788466796813
Inverse Condition #: 0.05055547164742644
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 56.85291 +/- 1.70828
  T-value: 33.28073104, P-value: 0.00000486
Parameter B: 0.03230 +/- 0.00349
  T-value: 9.25273028, P-value: 0.00075856

--- Model Fit Statistics ---

Number of Observations (n): 6
Number of Parameters (p): 2
Degrees of Freedom (n-p): 4

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 7.4843
Reduced Chi-Squared (from ODR): 1.8711

--- Information Criteria ---
Maximum Log-Likelihood: -14.7694
AIC (Akaike Information Criterion): 33.5388
BIC (Bayesian Information Criterion): 33.1224
AICc (Corrected AIC): 37.5388

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
     25.0000                 28.8059       51.3000              51.5075
     34.0000                 35.2314       44.6000              44.6782
     42.0000                 40.6080       39.8000              39.7000
     57.0000                 54.0004       29.9000              29.6115
     97.0000                 97.6458       10.3000              10.4382
</pre></div>
</div>
<img alt="../_images/8351f5fe91211fb8c40426f8ecbccf72fc6aa28e36560c2ada0fd11830f33d90.png" src="../_images/8351f5fe91211fb8c40426f8ecbccf72fc6aa28e36560c2ada0fd11830f33d90.png" />
<img alt="../_images/52b5c841f168f81e8f0e9b7fce0b9064d500f6964abe480ad910dd8b0823aff7.png" src="../_images/52b5c841f168f81e8f0e9b7fce0b9064d500f6964abe480ad910dd8b0823aff7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x, A, B) = A_1 * (np.exp(-B_1 * x) - 1) + A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">A_1</span> <span class="o">=</span> <span class="mf">56.769</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="n">B_1</span> <span class="o">=</span> <span class="mf">0.00988</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="c1"># A_1 = 56.747 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>
    <span class="c1"># B_1 = 0.00991 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>

    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [5.69770308e+01 3.20851523e-02]
Beta Std Error: [1.58710399 0.00338037]
Beta Covariance: [[ 2.88367706e+00 -5.19099807e-03]
 [-5.19099807e-03  1.30817316e-05]]
Residual Variance: 0.8735024809232925
Inverse Condition #: 0.04855655628987679
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 56.97703 +/- 1.58710
  T-value: 35.89999855, P-value: 0.00000359
Parameter B: 0.03209 +/- 0.00338
  T-value: 9.49159977, P-value: 0.00068758

--- Model Fit Statistics ---

Number of Observations (n): 6
Number of Parameters (p): 2
Degrees of Freedom (n-p): 4

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 3.4940
Reduced Chi-Squared (from ODR): 0.8735

--- Information Criteria ---
Maximum Log-Likelihood: -15.2071
AIC (Akaike Information Criterion): 34.4141
BIC (Bayesian Information Criterion): 33.9976
AICc (Corrected AIC): 38.4141

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
     25.0000                 28.9597       51.3000              51.3962
     34.0000                 35.3284       44.6000              44.6375
     42.0000                 40.5954       39.8000              39.7553
     57.0000                 53.7891       29.9000              29.7639
     97.0000                 97.6715       10.3000              10.3636
</pre></div>
</div>
<img alt="../_images/125d936a2b276555b6cab2bb449b35b4320a3a88fb7147c515d41c9122fcbeda.png" src="../_images/125d936a2b276555b6cab2bb449b35b4320a3a88fb7147c515d41c9122fcbeda.png" />
<img alt="../_images/a26a7f4ee0ddd3581befbebe6f09e9d0e84ea5b09b66e989b2fd492a83ce2cb0.png" src="../_images/a26a7f4ee0ddd3581befbebe6f09e9d0e84ea5b09b66e989b2fd492a83ce2cb0.png" />
</div>
</div>
</section>
<section id="more-than-2-parameters-in-the-non-linear-model">
<h3>More than 2 parameters in the non-linear model<a class="headerlink" href="#more-than-2-parameters-in-the-non-linear-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">draw_curve_fit_simple</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes the ODR fit with a 95% confidence band.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (dict): The dictionary returned by the analyze_odr function.</span>
<span class="sd">        model_function (callable): The model function used for the fit.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># --- 1. Unpack data from the results dictionary ---</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_x&quot;</span><span class="p">]</span>
    <span class="n">y_data</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_y&quot;</span><span class="p">]</span>
    <span class="n">sigma_x</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_sigma_x&quot;</span><span class="p">]</span>
    <span class="n">sigma_y</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;original_sigma_y&quot;</span><span class="p">]</span>
    <span class="n">popt</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;fit_params&#39;</span><span class="p">]</span>
    <span class="n">perr</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;std_errs&#39;</span><span class="p">]</span>
    
    <span class="c1"># --- 2. Set up the plot ---</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>

    <span class="c1"># --- 3. Plot the curve fit ---</span>
    
    <span class="c1"># Plot original data with error bars</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
        <span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> 
        <span class="n">xerr</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span> 
        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original Data&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span>
    <span class="p">)</span>

    <span class="c1"># Generate points for the fitted curve and confidence band</span>
    <span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
    <span class="n">y_plot</span> <span class="o">=</span> <span class="n">model_function</span><span class="p">(</span><span class="n">popt</span><span class="p">,</span> <span class="n">x_plot</span><span class="p">)</span>

    <span class="c1"># Plot the fitted curve</span>
    <span class="n">label_text</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;ODR Fitted Curve</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;$A_1$=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;A=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;B=</span><span class="si">{</span><span class="n">popt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">perr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_text</span><span class="p">)</span>

    <span class="c1"># --- 5. Configure title, labels, and final layout ---</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Orthogonal Distance Regression (ODR) Fit</span><span class="se">\n</span><span class="s2">Reduced $</span><span class="se">\\</span><span class="s2">chi^2$ = </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;reduced_chi_squared_odr&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X-Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y-Value&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">x_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">y_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># A_1 = 56.769 # obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="n">B_1</span> <span class="o">=</span> <span class="mf">0.00988</span> <span class="c1"># obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="c1"># A_1 = 56.747 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>
    <span class="c1"># B_1 = 0.00991 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>

    <span class="n">A_1</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">79.7</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mf">56.769</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit_simple</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">show_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [103.88824637  25.55010799   0.19522905]
Beta Std Error: [1.24956011 0.59488983 0.03870533]
Beta Covariance: [[ 1.65731942e+01 -7.51580025e+00  1.67335878e-01]
 [-7.51580025e+00  3.75634090e+00 -8.96855502e-02]
 [ 1.67335878e-01 -8.96855502e-02  1.59013315e-02]]
Residual Variance: 0.09421240332040559
Inverse Condition #: 0.0009228447241251511
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 103.88825 +/- 1.24956
  T-value: 83.13985531, P-value: 0.00000013
Parameter B: 25.55011 +/- 0.59489
  T-value: 42.94931078, P-value: 0.00000176
Parameter C: 0.19523 +/- 0.03871
  T-value: 5.04398357, P-value: 0.00726171

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 3
Degrees of Freedom (n-p): 4

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 0.3768
Reduced Chi-Squared (from ODR): 0.0942

--- Information Criteria ---
Maximum Log-Likelihood: -13.0536
AIC (Akaike Information Criterion): 32.1071
BIC (Bayesian Information Criterion): 31.9449
AICc (Corrected AIC): 40.1071

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
      5.0000                  4.7837       79.7000              79.6954
     25.0000                 25.6670       51.3000              51.3502
     34.0000                 34.2938       44.6000              44.6249
     42.0000                 41.1892       39.8000              39.7260
     57.0000                 56.7351       29.9000              29.8717
     97.0000                 97.1901       10.3000              10.3302
</pre></div>
</div>
<img alt="../_images/1c18555f3219288ea5f0025e72ef5b4b2a189a7abfb570161e739b6dc1a460a9.png" src="../_images/1c18555f3219288ea5f0025e72ef5b4b2a189a7abfb570161e739b6dc1a460a9.png" />
<img alt="../_images/4bf64bc14a87c7483ad0cb2bda4d95008d4254ca43c9019caec7963988a8bff6.png" src="../_images/4bf64bc14a87c7483ad0cb2bda4d95008d4254ca43c9019caec7963988a8bff6.png" />
</div>
</div>
</section>
</section>
<section id="usage-of-methods-dataset-2">
<h2>Usage of Methods. Dataset 2<a class="headerlink" href="#usage-of-methods-dataset-2" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># A_1 = 56.769 # obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="c1"># B_1 = 0.00988 # obtained from Dataset 3 with sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="c1"># A_1 = 56.747 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>
    <span class="c1"># B_1 = 0.00991 # obtained from Dataset 3 with sigma_x = 3.0, sigma_y = 0.5</span>

    <span class="n">A_1</span><span class="p">,</span> <span class="n">B_1</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 2</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">391</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">80.4</span><span class="p">,</span> <span class="mf">66.4</span><span class="p">,</span> <span class="mf">50.1</span><span class="p">,</span> <span class="mf">41.2</span><span class="p">,</span> <span class="mf">28.5</span><span class="p">,</span> <span class="mf">20.1</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mf">56.769</span><span class="p">,</span> <span class="mf">0.00988</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit_simple</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [2.53713448e+02 4.53053930e-04 3.89974446e+01 3.06987722e-02]
Beta Std Error: [7.71860840e+02 1.57276072e-03 6.13338708e+00 7.45952575e-03]
Beta Covariance: [[ 1.86388581e+05 -3.79720031e-01  1.40483870e+03 -1.40898434e+00]
 [-3.79720031e-01  7.73867479e-07 -2.87957172e-03  2.90053542e-06]
 [ 1.40483870e+03 -2.87957172e-03  1.17690670e+01 -1.27312615e-02]
 [-1.40898434e+00  2.90053542e-06 -1.27312615e-02  1.74085950e-05]]
Residual Variance: 3.196382277215617
Inverse Condition #: 5.9563264880884864e-05
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 253.71345 +/- 771.86084
  T-value: 0.32870361, P-value: 0.76398808
Parameter B: 0.00045 +/- 0.00157
  T-value: 0.28806285, P-value: 0.79205359
Parameter C: 38.99744 +/- 6.13339
  T-value: 6.35822329, P-value: 0.00787193
Parameter D: 0.03070 +/- 0.00746
  T-value: 4.11537855, P-value: 0.02599280

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 4
Degrees of Freedom (n-p): 3

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 9.5891
Reduced Chi-Squared (from ODR): 3.1964

--- Information Criteria ---
Maximum Log-Likelihood: -17.6597
AIC (Akaike Information Criterion): 43.3194
BIC (Bayesian Information Criterion): 43.1031
AICc (Corrected AIC): 63.3194

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
     19.0000                 19.2222       80.4000              80.4179
     45.0000                 43.7270       66.4000              66.2130
    104.0000                105.4845       50.1000              50.6927
    191.0000                189.3603       41.2000              40.2604
    294.0000                295.2020       28.5000              29.2461
    391.0000                390.6172       20.1000              19.8516
</pre></div>
</div>
<img alt="../_images/76ebc20ae112f760c395c419cc009a92757dbd6901ea125247e03e0781927e15.png" src="../_images/76ebc20ae112f760c395c419cc009a92757dbd6901ea125247e03e0781927e15.png" />
<img alt="../_images/d98367262516bf2103a6cb552366bfa2a8293e1c67bb782efa057448afdeeee4.png" src="../_images/d98367262516bf2103a6cb552366bfa2a8293e1c67bb782efa057448afdeeee4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">A_1</span> <span class="o">=</span> <span class="mf">56.769</span> <span class="c1"># sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="n">B_1</span> <span class="o">=</span> <span class="mf">0.00988</span> <span class="c1"># sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 2</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">294</span><span class="p">,</span> <span class="mi">391</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">80.4</span><span class="p">,</span> <span class="mf">66.4</span><span class="p">,</span> <span class="mf">50.1</span><span class="p">,</span> <span class="mf">41.2</span><span class="p">,</span> <span class="mf">28.5</span><span class="p">,</span> <span class="mf">20.1</span><span class="p">])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="n">draw_curve_fit</span><span class="p">(</span><span class="n">odr_results</span><span class="p">,</span> <span class="n">model_function</span><span class="p">)</span>

<span class="c1"># Plot predicted vs observed values</span>
<span class="n">plot_predicted_vs_observed</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [2.76981551e+01 4.16977620e-03]
Beta Std Error: [1.25121372e+01 3.64100285e-03]
Beta Covariance: [[ 2.78029142e+01 -7.85680679e-03]
 [-7.85680679e-03  2.35434096e-06]]
Residual Variance: 5.6308334189452305
Inverse Condition #: 0.1070099068440495
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 27.69816 +/- 12.51214
  T-value: 2.21370295, P-value: 0.07774146
Parameter B: 0.00417 +/- 0.00364
  T-value: 1.14522739, P-value: 0.30395559

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 2
Degrees of Freedom (n-p): 5

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 28.1542
Reduced Chi-Squared (from ODR): 5.6308

--- Information Criteria ---
Maximum Log-Likelihood: -41.7137
AIC (Akaike Information Criterion): 87.4274
BIC (Bayesian Information Criterion): 87.3193
AICc (Corrected AIC): 90.4274

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
     19.0000                 30.3028       80.4000              82.0244
     45.0000                 58.8382       66.4000              68.9478
    104.0000                110.6902       50.1000              52.0088
    191.0000                184.0136       41.2000              37.6081
    294.0000                292.5648       28.5000              26.8641
    391.0000                391.9280       20.1000              22.1182
</pre></div>
</div>
<img alt="../_images/915f69c95f08cdc952a1535f67949a38f39da75e61be09d07eb3cfa8700c6316.png" src="../_images/915f69c95f08cdc952a1535f67949a38f39da75e61be09d07eb3cfa8700c6316.png" />
<img alt="../_images/d3e49bc6c0e8fec89075f2d8d40467668f16bdcb2742f11786eae2c6b0d4aa66.png" src="../_images/d3e49bc6c0e8fec89075f2d8d40467668f16bdcb2742f11786eae2c6b0d4aa66.png" />
</div>
</div>
</section>
<section id="code-3">
<h2>Code 3<a class="headerlink" href="#code-3" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_function</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The custom function to approximate the data.</span>
<span class="sd">    f(x; A, B) = A * (np.exp(-B * x) - 1) + 100</span>
<span class="sd">    Note: The signature is now (beta, x) for scipy.odr.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">A_1</span> <span class="o">=</span> <span class="mf">56.769</span> <span class="c1"># sigma_x = 2.0, sigma_y = 0.5</span>
    <span class="n">B_1</span> <span class="o">=</span> <span class="mf">0.00988</span> <span class="c1"># sigma_x = 2.0, sigma_y = 0.5</span>

    <span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">beta</span>
    
    <span class="k">return</span> <span class="n">A_1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B_1</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>

<span class="c1"># Dataset 1</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">97</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mf">79.7</span><span class="p">,</span> <span class="mf">51.3</span><span class="p">,</span> <span class="mf">44.6</span><span class="p">,</span> <span class="mf">39.8</span><span class="p">,</span> <span class="mf">29.9</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">])</span>

<span class="c1"># Dataset 2</span>
<span class="c1"># x = np.array([0, 19, 45, 104, 191, 294, 391])</span>
<span class="c1"># y_obs = np.array([100, 80.4, 66.4, 50.1, 41.2, 28.5, 20.1])</span>
<span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="c1"># Analyze the curve fit and get results using ODR</span>
<span class="n">odr_results</span> <span class="o">=</span> <span class="n">analyze_odr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">model_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">)</span>

<span class="c1"># Print the metrics</span>
<span class="n">print_metrics</span><span class="p">(</span><span class="n">odr_results</span><span class="p">)</span>

<span class="c1"># Draw the curve fit plot</span>
<span class="c1"># draw_curve_fit_odr(odr_results, model_function)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- ODR Fit Results ---
Beta: [5.62756354e+01 3.37856894e-02]
Beta Std Error: [2.01225938 0.00423834]
Beta Covariance: [[ 3.84235651e+00 -6.72589726e-03]
 [-6.72589726e-03  1.70459194e-05]]
Residual Variance: 1.0538292845024835
Inverse Condition #: 0.05122048290906237
Reason(s) for Halting:
  Sum of squares convergence

--- Summary of Results ---
Parameter A: 56.27564 +/- 2.01226
  T-value: 27.96639236, P-value: 0.00000109
Parameter B: 0.03379 +/- 0.00424
  T-value: 7.97145206, P-value: 0.00050124

--- Model Fit Statistics ---

Number of Observations (n): 7
Number of Parameters (p): 2
Degrees of Freedom (n-p): 5

--- Goodness-of-Fit &amp; Error Metrics ---
Chi-Squared (from ODR): 5.2691
Reduced Chi-Squared (from ODR): 1.0538

--- Information Criteria ---
Maximum Log-Likelihood: -23.1900
AIC (Akaike Information Criterion): 50.3800
BIC (Bayesian Information Criterion): 50.2718
AICc (Corrected AIC): 53.3800

--- Comparison of Original and Predicted Data Points ---
  Original X    Predicted X (x_plus)    Original Y    Predicted Y (fit)
------------  ----------------------  ------------  -------------------
      0.0000                  0.0000      100.0000             100.0000
      5.0000                  9.2447       79.7000              79.9478
     25.0000                 28.2134       51.3000              51.6085
     34.0000                 34.6941       44.6000              44.6781
     42.0000                 40.2175       39.8000              39.5712
     57.0000                 53.9433       29.9000              29.3664
     97.0000                 97.8134       10.3000              10.6191
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./math"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="orthogonal-distance-regression.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Orthogonal Distance Regression</p>
      </div>
    </a>
    <a class="right-next"
       href="../physics/continuity-equation-01.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">The Continuity Equation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-investigation-of-odr">General Investigation of ODR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inverse-condition-number">Inverse Condition Number</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reason-s-for-halting-sum-of-squares-convergence">Reason(s) for Halting: Sum of Squares Convergence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predicted-values-of-x-and-y">Predicted values of x and y</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#general-methods-for-odr-analysis">General Methods for ODR Analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-of-methods-dataset-3">Usage of Methods. Dataset 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-of-methods-dataset-1">Usage of Methods. Dataset 1</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#improved-model-function">Improved model function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-than-2-parameters-in-the-non-linear-model">More than 2 parameters in the non-linear model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#usage-of-methods-dataset-2">Usage of Methods. Dataset 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#code-3">Code 3</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Vladyslav Yakovliev (Ukraine)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>