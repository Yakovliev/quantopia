
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>WLS - Code Examples Part 1 &#8212; Quantopia&#39;:&#39; Physics, Python and Pi</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'math/weighted-least-squares-code-1';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="WLS - Code Examples Part 2" href="weighted-least-squares-code-2.html" />
    <link rel="prev" title="Weighted Least Squares" href="weighted-least-squares.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Quantopia':' Physics, Python and Pi - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Quantopia':' Physics, Python and Pi - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Quantopia: Physics, Python, and Pi (Alpha Version)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">MATH</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gradient-operator.html">Gradient</a></li>
<li class="toctree-l1"><a class="reference internal" href="gradient-directional-derivative.html">Directional Derivative</a></li>
<li class="toctree-l1"><a class="reference internal" href="divergence.html">Divergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="fourier-transform-01.html">Fourier Transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="least-squares-regression.html">Least Squares Regression, RSS, RMSE, R-squared</a></li>
<li class="toctree-l1"><a class="reference internal" href="least-squares-regression-code.html">Least Squares Regression - Code Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="ordinary-least-squares.html">Ordinary Least Squares (OLS) Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="ordinary-least-squares-code.html">Ordinary Least Squares (OLS) Regression - Code Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="variance-covariance.html">Variance and Covariance</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted-least-squares.html">Weighted Least Squares</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">WLS - Code Examples Part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted-least-squares-code-2.html">WLS - Code Examples Part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="goodness-of-fit-and-chi-squared.html">Goodness of Fit and Chi-Squared Statistic</a></li>
<li class="toctree-l1"><a class="reference internal" href="aic-and-bic.html">Akaike Information Criterion (AIC) and Bayesian Information Criterion (BIC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighted-least-squares-code-3.html">WLS - Code Examples Part 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="orthogonal-distance-regression.html">Orthogonal Distance Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="odr-code.html">ODR - Code Examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">PHYSICS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../physics/continuity-equation-01.html">The Continuity Equation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/continuity-equation-02.html">The Continuity Equation: One-Dimensional Advection of a Density Profile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/ensemble.html">Statistical Ensembles and Liouville’s Theorem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../physics/microcanonical-ensemble.html">Microcanonical Ensemble</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/Yakovliev/quantopia/blob/main/book/math/weighted-least-squares-code-1.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/Yakovliev/quantopia" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/Yakovliev/quantopia/issues/new?title=Issue%20on%20page%20%2Fmath/weighted-least-squares-code-1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/math/weighted-least-squares-code-1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>WLS - Code Examples Part 1</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1">Example 1</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-intercept-term-in-linear-regression">The Intercept Term in Linear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-sm-add-constant-works">How <code class="docutils literal notranslate"><span class="pre">sm.add_constant</span></code> Works</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#output-analysis">Output Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-t-statistic-t">The t-statistic (<span class="math notranslate nohighlight">\(t\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-p-value-p-t">The P-value (<span class="math notranslate nohighlight">\(P&gt;|t|\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-confidence-interval-0-025-0-975">The Confidence Interval ([0.025 0.975])</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-results-scale-means">What <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> Means</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#log-likelihood">Log-Likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-and-prediction-intervals">Confidence and Prediction Intervals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-interval-mean-ci-lower-and-mean-ci-upper">Confidence Interval: <code class="docutils literal notranslate"><span class="pre">mean_ci_lower</span></code> and <code class="docutils literal notranslate"><span class="pre">mean_ci_upper</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-interval-obs-ci-lower-and-obs-ci-upper">Prediction Interval: <code class="docutils literal notranslate"><span class="pre">obs_ci_lower</span></code> and <code class="docutils literal notranslate"><span class="pre">obs_ci_upper</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comment-about-the-3rd-plot-weighted-residuals-of-the-wls-fit">Comment about the 3rd Plot (Weighted Residuals of the WLS fit)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2">Example 2</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Output Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-3">Example 3</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-sigma-parameter">Absolute sigma parameter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-sigma-false"><code class="docutils literal notranslate"><span class="pre">absolute_sigma=False</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-sigma-true"><code class="docutils literal notranslate"><span class="pre">absolute_sigma=True</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Log-Likelihood</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="wls-code-examples-part-1">
<h1>WLS - Code Examples Part 1<a class="headerlink" href="#wls-code-examples-part-1" title="Link to this heading">#</a></h1>
<section id="example-1">
<h2>Example 1<a class="headerlink" href="#example-1" title="Link to this heading">#</a></h2>
<p>Documentation link: <a class="reference external" href="https://www.statsmodels.org/dev/generated/statsmodels.regression.linear_model.RegressionResults.html#statsmodels.regression.linear_model.RegressionResults">https://www.statsmodels.org/dev/generated/statsmodels.regression.linear_model.RegressionResults.html#statsmodels.regression.linear_model.RegressionResults</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tools.eval_measures</span><span class="w"> </span><span class="kn">import</span> <span class="n">rmse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample data from a hypothetical physics experiment</span>
<span class="c1"># x represents an independent variable</span>
<span class="c1"># y_obs represents the observed dependent variable</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">11.8</span><span class="p">,</span> <span class="mf">14.1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard deviation for each data point</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The weights for WLS are the inverse of the variance (1 / sigma^2)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Add a constant to the independent variable to include an intercept in the model</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[1. 1.]
 [1. 2.]
 [1. 3.]
 [1. 4.]
 [1. 5.]
 [1. 6.]
 [1. 7.]
 [1. 8.]]
</pre></div>
</div>
</div>
</div>
<section id="the-intercept-term-in-linear-regression">
<h3>The Intercept Term in Linear Regression<a class="headerlink" href="#the-intercept-term-in-linear-regression" title="Link to this heading">#</a></h3>
<p>In a linear regression model, the relationship between a dependent variable (<span class="math notranslate nohighlight">\(y\)</span>) and an independent variable (<span class="math notranslate nohighlight">\(x\)</span>) is expressed as:</p>
<p><span class="math notranslate nohighlight">\(y = \beta_0 + \beta_1x + \epsilon\)</span></p>
<p>Here, <span class="math notranslate nohighlight">\(\beta_0\)</span> is the <strong>intercept</strong> and <span class="math notranslate nohighlight">\(\beta_1\)</span> is the slope. The intercept (<span class="math notranslate nohighlight">\(\beta_0\)</span>) represents the expected value of <span class="math notranslate nohighlight">\(y\)</span> when <span class="math notranslate nohighlight">\(x\)</span> is zero. In the context of our code, it represents the baseline spending when income is zero. The <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> library, by default, expects you to explicitly include this intercept term as a column of ones in your predictor matrix. This is because it treats the linear model as:</p>
<p><span class="math notranslate nohighlight">\(y = \beta_0 \cdot 1 + \beta_1 \cdot x + \epsilon\)</span></p>
<p>By adding a constant column of ones to your predictor variables, you’re creating a matrix where the first column is a representation of the constant term (1), allowing the model to estimate the coefficient <span class="math notranslate nohighlight">\(\beta_0\)</span>.</p>
</section>
<section id="how-sm-add-constant-works">
<h3>How <code class="docutils literal notranslate"><span class="pre">sm.add_constant</span></code> Works<a class="headerlink" href="#how-sm-add-constant-works" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">sm.add_constant(income)</span></code> function takes the <code class="docutils literal notranslate"><span class="pre">income</span></code> array and adds a new column of ones to the beginning of it.</p>
<ul class="simple">
<li><p><strong>Original <code class="docutils literal notranslate"><span class="pre">income</span></code> array:</strong>
<code class="docutils literal notranslate"><span class="pre">[1.0,</span> <span class="pre">2.0,</span> <span class="pre">...,</span> <span class="pre">8.0]</span></code></p></li>
<li><p><strong>After <code class="docutils literal notranslate"><span class="pre">sm.add_constant(income)</span></code>:</strong>
<code class="docutils literal notranslate"><span class="pre">[[1.0,</span> <span class="pre">1.0],</span> <span class="pre">[1.0,</span> <span class="pre">2.0],</span> <span class="pre">...,</span> <span class="pre">[1.0,</span> <span class="pre">8.0]]</span></code></p></li>
</ul>
<p>This modified array, named <code class="docutils literal notranslate"><span class="pre">X</span></code>, now has two columns. The first column (all ones) is used to calculate the intercept, while the second column (<code class="docutils literal notranslate"><span class="pre">income</span></code>) is used to calculate the slope. This is why the in the comment to the code we mentioned “(for the intercept)”; it’s explicitly explaining the purpose of adding the constant column.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit the Weighted Least Squares model</span>
<span class="n">wls_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">WLS</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">wls_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># --- Print the detailed summary of the regression ---</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            WLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.996
Model:                            WLS   Adj. R-squared:                  0.995
Method:                 Least Squares   F-statistic:                     1443.
Date:                Fri, 22 Aug 2025   Prob (F-statistic):           2.22e-08
Time:                        00:02:47   Log-Likelihood:               0.049782
No. Observations:                   8   AIC:                             3.900
Df Residuals:                       6   BIC:                             4.059
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.6375      0.126      5.078      0.002       0.330       0.945
x1             1.5857      0.042     37.986      0.000       1.484       1.688
==============================================================================
Omnibus:                        0.030   Durbin-Watson:                   1.334
Prob(Omnibus):                  0.985   Jarque-Bera (JB):                0.183
Skew:                           0.086   Prob(JB):                        0.913
Kurtosis:                       2.280   Cond. No.                         5.31
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
</section>
<section id="output-analysis">
<h3>Output Analysis<a class="headerlink" href="#output-analysis" title="Link to this heading">#</a></h3>
<p>The parameters <code class="docutils literal notranslate"><span class="pre">t</span></code>, <code class="docutils literal notranslate"><span class="pre">P&gt;|t|</span></code>, and <code class="docutils literal notranslate"><span class="pre">[0.025</span> <span class="pre">0.975]</span></code> are essential for <strong>hypothesis testing</strong> and <strong>confidence interval estimation</strong>. They help us determine if the relationship between our independent and dependent variables is statistically significant.</p>
</section>
<section id="the-t-statistic-t">
<h3>The t-statistic (<span class="math notranslate nohighlight">\(t\)</span>)<a class="headerlink" href="#the-t-statistic-t" title="Link to this heading">#</a></h3>
<p>The <strong>t-statistic</strong> measures how many standard deviations the estimated coefficient is from zero. In other words, it quantifies the evidence against the null hypothesis (<span class="math notranslate nohighlight">\(H_0\)</span>), which states that the true coefficient is zero (i.e., there is no relationship between the independent and dependent variables). A larger absolute value of <span class="math notranslate nohighlight">\(t\)</span> indicates that the coefficient is less likely to be zero by chance.</p>
<div class="math notranslate nohighlight">
\[t = \frac{\text{Estimated Coefficient} - 0}{\text{Standard Error of the Coefficient}}\]</div>
<p>In our output:</p>
<ul class="simple">
<li><p>For the intercept <span class="math notranslate nohighlight">\(\beta_0\)</span>: <span class="math notranslate nohighlight">\(t = \frac{0.6375}{0.126} \approx 5.078\)</span>.</p></li>
<li><p>For the slope coefficient <span class="math notranslate nohighlight">\(\beta_1\)</span>: <span class="math notranslate nohighlight">\(t = \frac{1.5857}{0.042} \approx 37.986\)</span>.</p></li>
</ul>
<p>The very high <span class="math notranslate nohighlight">\(t\)</span>-statistic for the slope coefficient (<span class="math notranslate nohighlight">\(37.986\)</span>) strongly suggests that the slope is not zero, meaning there is a significant relationship between <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>.</p>
</section>
<section id="the-p-value-p-t">
<h3>The P-value (<span class="math notranslate nohighlight">\(P&gt;|t|\)</span>)<a class="headerlink" href="#the-p-value-p-t" title="Link to this heading">#</a></h3>
<p>The <strong>P-value</strong> is the probability of observing a <span class="math notranslate nohighlight">\(t\)</span>-statistic as extreme as, or more extreme than, the one calculated, assuming the null hypothesis is true. A small P-value provides strong evidence to <strong>reject the null hypothesis</strong>. The common threshold for significance is <span class="math notranslate nohighlight">\(\alpha = 0.05\)</span>. If our P-value is less than 0.05, we can conclude that the coefficient is statistically significant.</p>
<p>In our output:</p>
<ul class="simple">
<li><p>For the intercept <span class="math notranslate nohighlight">\(\beta_0\)</span>: the P-value is 0.002</p></li>
<li><p>For the slope coefficient <span class="math notranslate nohighlight">\(\beta_1\)</span>: the P-value is 0.000</p></li>
<li><p>This means the probability of observing these coefficients if there were no real relationship is practically zero. You can confidently reject the null hypothesis and conclude that both the intercept and the slope are statistically significant.</p></li>
</ul>
</section>
<section id="the-confidence-interval-0-025-0-975">
<h3>The Confidence Interval ([0.025 0.975])<a class="headerlink" href="#the-confidence-interval-0-025-0-975" title="Link to this heading">#</a></h3>
<p>The <strong>confidence interval</strong> is a range of values that likely contains the true, unknown value of the coefficient. The <code class="docutils literal notranslate"><span class="pre">[0.025</span> <span class="pre">0.975]</span></code> columns represent the <strong>95% confidence interval</strong>, meaning that if you were to repeat our sampling and analysis many times, 95% of the calculated confidence intervals would contain the true population parameter. The key takeaway is to see if this interval includes zero. If the interval does not contain zero, it is further evidence that the coefficient is statistically significant, consistent with a low P-value.</p>
<p>In our output:</p>
<ul class="simple">
<li><p>For the intercept <span class="math notranslate nohighlight">\(\beta_0\)</span>: The 95% confidence interval is <code class="docutils literal notranslate"><span class="pre">[0.330,</span> <span class="pre">0.945]</span></code>. Since this range does not contain zero, the intercept is statistically significant.</p></li>
<li><p>For the income coefficient (<span class="math notranslate nohighlight">\(\beta_1\)</span>): The 95% confidence interval is <code class="docutils literal notranslate"><span class="pre">[1.484,</span> <span class="pre">1.688]</span></code>. This range also does not contain zero.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Degrees of Freedom</span>
<span class="n">degrees_of_freedom</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of Freedom: </span><span class="si">{</span><span class="n">degrees_of_freedom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Observations: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">condition_number</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">condition_number</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Condition Number: </span><span class="si">{</span><span class="n">condition_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Degrees of Freedom: 6.0
Number of Observations: 8.0
Condition Number: 5.307859000400287
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_value_intercept</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Intercept: </span><span class="si">{</span><span class="n">t_value_intercept</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">t_value_slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Slope: </span><span class="si">{</span><span class="n">t_value_slope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>T-value for Intercept: 5.078177576125257
T-value for Slope: 37.98558492481207
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_value_intercept</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Intercept: </span><span class="si">{</span><span class="n">p_value_intercept</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">p_value_slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Slope: </span><span class="si">{</span><span class="n">p_value_slope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P-value for Intercept: 0.002269613591419451
P-value for Slope: 2.2225928494730514e-08
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_value_intercept_scipy</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_intercept</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># two-tailed p-value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Intercept (SciPy): </span><span class="si">{</span><span class="n">p_value_intercept_scipy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">p_value_slope_scipy</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_slope</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># two-tailed p-value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Slope (SciPy): </span><span class="si">{</span><span class="n">p_value_slope_scipy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P-value for Intercept (SciPy): 0.002269613591419451
P-value for Slope (SciPy): 2.2225928494730514e-08
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- 1) Calculate RSS using results.resid (unweighted residuals) ---</span>
<span class="n">rss_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) RSS from unweighted residuals (results.resid): </span><span class="si">{</span><span class="n">rss_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- 2) Calculate RSS using results.wresid (weighted residuals) ---</span>
<span class="c1"># This is the value that WLS minimizes.</span>
<span class="n">rss_weighted_from_wresid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">wresid</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2) Weighted RSS from weighted residuals (results.wresid): </span><span class="si">{</span><span class="n">rss_weighted_from_wresid</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">rss_weighted_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ssr</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) Weighted RSS from results.ssr: </span><span class="si">{</span><span class="n">rss_weighted_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- 3) Calculate RSS manually using the linear equation ---</span>
<span class="c1"># Get the coefficients from the model results</span>
<span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span>
<span class="c1"># Calculate the predicted y values</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">intercept</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span>
<span class="c1"># Calculate the residuals manually</span>
<span class="n">manual_residuals</span> <span class="o">=</span> <span class="n">y_obs</span> <span class="o">-</span> <span class="n">y_pred</span>
<span class="c1"># Square and sum the residuals</span>
<span class="n">rss_unweighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">manual_residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) Manually calculated RSS (unweighted): </span><span class="si">{</span><span class="n">rss_unweighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- 4) Calculate weighted RSS manually ---</span>
<span class="c1"># Use the manual residuals and the weights</span>
<span class="n">manual_weighted_residuals_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">manual_residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span>
<span class="n">rss_weighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">manual_weighted_residuals_sq</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) Manually calculated Weighted RSS: </span><span class="si">{</span><span class="n">rss_weighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Verification ---</span>
<span class="c1"># Note that the unweighted RSS values from (1) and (3) should be identical.</span>
<span class="c1"># The weighted RSS values from (2) and (4) should also be identical.</span>
<span class="c1"># The small differences might occur due to floating-point precision.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1) RSS from unweighted residuals (results.resid): 0.8626
2) Weighted RSS from weighted residuals (results.wresid): 1.8848
3) Weighted RSS from results.ssr: 1.8848
4) Manually calculated RSS (unweighted): 0.8626
5) Manually calculated Weighted RSS: 1.8848
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) print tss value using results.centered_tss</span>
<span class="n">centered_tss_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total weighted sum of squares centered about the mean (statsmodels results.centered_tss): </span><span class="si">{</span><span class="n">centered_tss_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 2) print tss value using results.uncentered_tss</span>
<span class="n">uncentered_tss_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">uncentered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uncentered total weighted sum of squares (statsmodels results.uncentered_tss): </span><span class="si">{</span><span class="n">uncentered_tss_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 3) calculate centered_tss manually</span>
<span class="c1"># First, calculate the weighted mean of y_obs</span>
<span class="n">weighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="c1"># Then, calculate the centered_tss using the formula</span>
<span class="n">weighted_centered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual calculation of total (weighted) sum of squares centered about the mean: </span><span class="si">{</span><span class="n">weighted_centered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 4) calculate uncentered_tss manually</span>
<span class="c1"># The formula is the sum of weighted squared y values</span>
<span class="n">weighted_uncentered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual calculation of uncentered total (weighted) sum of squares: </span><span class="si">{</span><span class="n">weighted_uncentered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual Unweighted Calculations ---</span>

<span class="c1"># 5) calculate unweighted centered_tss manually</span>
<span class="c1"># First, calculate the standard (unweighted) mean of y_obs</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="c1"># Then, calculate the unweighted centered_tss</span>
<span class="c1"># Formula: sum((y_obs - mean(y_obs))^2)</span>
<span class="n">unweighted_centered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual calculation of unweighted TSS centered about the mean: </span><span class="si">{</span><span class="n">unweighted_centered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 6) calculate unweighted uncentered_tss manually</span>
<span class="c1"># The formula is the sum of squared y values without weighting</span>
<span class="c1"># Formula: sum(y_obs^2)</span>
<span class="n">unweighted_uncentered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_obs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual calculation of uncentered unweighted TSS: </span><span class="si">{</span><span class="n">unweighted_uncentered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total weighted sum of squares centered about the mean (statsmodels results.centered_tss): 455.1540
Uncentered total weighted sum of squares (statsmodels results.uncentered_tss): 1511.9919

Manual calculation of total (weighted) sum of squares centered about the mean: 455.1540
Manual calculation of uncentered total (weighted) sum of squares: 1511.9919

Manual calculation of unweighted TSS centered about the mean: 116.4488
Manual calculation of uncentered unweighted TSS: 604.7300
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ess</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ess</span> <span class="c1"># The explained sum of squares.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Explained Sum of Squares (ESS): </span><span class="si">{</span><span class="n">ess</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manually calculate the ESS</span>
<span class="c1"># Get the fitted values (y_hat) from the model</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Calculate the weighted mean of y_obs</span>
<span class="n">weighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

<span class="c1"># Calculate ESS using the formula: sum(weights * (y_hat - weighted_mean_y)^2)</span>
<span class="n">ess_weighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_hat</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Explained Sum of Squares (ESS) manual calculation: </span><span class="si">{</span><span class="n">ess_weighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calculate the unweighted mean of y_obs</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># Finally, calculate the unweighted ESS using the formula: sum((y_hat - unweighted_mean_y)^2)</span>
<span class="n">ess_unweighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_hat</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Explained Sum of Squares (ESS) unweighted manual calculation: </span><span class="si">{</span><span class="n">ess_unweighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Weighted Explained Sum of Squares (ESS): 453.2692
Weighted Explained Sum of Squares (ESS) manual calculation: 453.2692
Explained Sum of Squares (ESS) unweighted manual calculation: 105.6192
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the number of observations and parameters</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># df_model is number of explanatory variables, add 1 for intercept</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of observations (n): </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of parameters (p): </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of observations (n): 8.0
Number of parameters (p): 2.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_squared</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted R-squared (statsmodels results.rsquared): </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">r_squared_adj</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared_adj</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Adjusted R-squared (statsmodels results.rsquared_adj): </span><span class="si">{</span><span class="n">r_squared_adj</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual calculation of Weighted R-squared ---</span>

<span class="n">r_squared_manual_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="n">weighted_centered_tss_manual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted R-squared (1 - RSS_w/TSS_w): </span><span class="si">{</span><span class="n">r_squared_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Weighted Adjusted R-squared</span>
<span class="c1"># Formula: 1 - (1 - R^2_w) * ((n-1)/(n-p))</span>
<span class="n">r_squared_adj_manual_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_manual_weighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual calculation of Unweighted R-squared ---</span>
<span class="c1"># We need to calculate the unweighted centered TSS first</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="n">unweighted_centered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">r_squared_manual_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="n">unweighted_centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Unweighted R-squared (1 - RSS/TSS): </span><span class="si">{</span><span class="n">r_squared_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Unweighted Adjusted R-squared</span>
<span class="c1"># Formula: 1 - (1 - R^2_unweighted) * ((n-1)/(n-p))</span>
<span class="n">r_squared_adj_manual_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_manual_unweighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Formula: ESS_weighted / TSS_centered_weighted</span>
<span class="n">r_squared_manual_weighted_2</span> <span class="o">=</span> <span class="n">ess_weighted_manual</span> <span class="o">/</span> <span class="n">weighted_centered_tss_manual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted R-squared (alternative formula) (ESS_w/TSS_w): </span><span class="si">{</span><span class="n">r_squared_manual_weighted_2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Formula: ESS_unweighted / TSS_centered_unweighted</span>
<span class="n">r_squared_manual_unweighted_2</span> <span class="o">=</span> <span class="n">ess_unweighted_manual</span> <span class="o">/</span> <span class="n">unweighted_centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted R-squared alternative formula (ESS/TSS): </span><span class="si">{</span><span class="n">r_squared_manual_unweighted_2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Weighted R-squared (statsmodels results.rsquared): 0.9959
Weighted Adjusted R-squared (statsmodels results.rsquared_adj): 0.9952

Manual Weighted R-squared (1 - RSS_w/TSS_w): 0.9959
Manual Weighted Adjusted R-squared: 0.9952

Manual Unweighted R-squared (1 - RSS/TSS): 0.9926
Manual Unweighted Adjusted R-squared: 0.9914

Manual Weighted R-squared (alternative formula) (ESS_w/TSS_w): 0.9959
Manual Unweighted R-squared alternative formula (ESS/TSS): 0.9070
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Chi-Squared</span>
<span class="n">chi_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">())</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi-Squared: </span><span class="si">{</span><span class="n">chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Reduced Chi-Squared</span>
<span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">chi_squared</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced Chi-Squared: </span><span class="si">{</span><span class="n">reduced_chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chi-Squared: 1.8848
Reduced Chi-Squared: 0.3141
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Root Mean Squared Error (RMSE) Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Root Mean Squared Error (RMSE) ---&quot;</span><span class="p">)</span>

<span class="c1"># RMSE from statsmodels (this is an unweighted RMSE)</span>
<span class="n">rmse_val</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE (statsmodels.tools.eval_measures.rmse method): </span><span class="si">{</span><span class="n">rmse_val</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Unweighted RMSE</span>
<span class="c1"># Formula: sqrt(sum of squared unweighted residuals / number of observations)</span>
<span class="n">rmse_manual_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted RMSE: </span><span class="si">{</span><span class="n">rmse_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Weighted RMSE</span>
<span class="c1"># Formula: sqrt(sum of squared weighted residuals / sum of weights)</span>
<span class="n">rmse_manual_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted RMSE: </span><span class="si">{</span><span class="n">rmse_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Root Mean Squared Error (RMSE) ---
RMSE (statsmodels.tools.eval_measures.rmse method): 0.3284
Manual Unweighted RMSE: 0.3284
Manual Weighted RMSE: 0.1869
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Standard Error of the Regression (SER) Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Standard Error of the Regression (SER) ---&quot;</span><span class="p">)</span>

<span class="c1"># SER from statsmodels results (this is a weighted SER)</span>
<span class="c1"># It is the square root of the weighted RSS divided by the degrees of freedom</span>
<span class="n">ser_sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">ssr</span> <span class="o">/</span> <span class="n">results</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SER (from statsmodels results): </span><span class="si">{</span><span class="n">ser_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Weighted SER</span>
<span class="c1"># This should match the value from statsmodels</span>
<span class="c1"># Formula: sqrt(sum of squared weighted residuals / degrees of freedom)</span>
<span class="n">ser_manual_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted SER: </span><span class="si">{</span><span class="n">ser_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Unweighted SER</span>
<span class="c1"># Formula: sqrt(sum of squared unweighted residuals / degrees of freedom)</span>
<span class="n">ser_manual_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted SER: </span><span class="si">{</span><span class="n">ser_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Standard Error of the Regression (SER) ---
SER (from statsmodels results): 0.5605
Manual Weighted SER: 0.5605
Manual Unweighted SER: 0.3792
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># --- MSE values from statsmodels results ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Statsmodels Results (Weighted) ---&quot;</span><span class="p">)</span>
<span class="n">mse_model_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">mse_model</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Squared Error of the Model (mse_model): </span><span class="si">{</span><span class="n">mse_model_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">mse_resid_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">mse_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Squared Error of the Residuals (MSE) (mse_resid): </span><span class="si">{</span><span class="n">mse_resid_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">mse_total_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">mse_total</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Mean Squared Error (mse_total): </span><span class="si">{</span><span class="n">mse_total_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Manual Calculations ---&quot;</span><span class="p">)</span>

<span class="c1"># 1. MSE Model</span>
<span class="n">mse_model_manual_weighted</span> <span class="o">=</span> <span class="n">ess_weighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_model_manual_unweighted</span> <span class="o">=</span> <span class="n">ess_unweighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted mse_model: </span><span class="si">{</span><span class="n">mse_model_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Should match statsmodels)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted mse_model: </span><span class="si">{</span><span class="n">mse_model_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 2. MSE Residuals</span>
<span class="n">mse_resid_manual_weighted</span> <span class="o">=</span> <span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
<span class="n">mse_resid_manual_unweighted</span> <span class="o">=</span> <span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted mse_resid: </span><span class="si">{</span><span class="n">mse_resid_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Should match statsmodels)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted mse_resid: </span><span class="si">{</span><span class="n">mse_resid_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 3. MSE Total</span>
<span class="n">mse_total_manual_weighted</span> <span class="o">=</span> <span class="n">weighted_centered_tss_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_total_manual_unweighted</span> <span class="o">=</span> <span class="n">unweighted_centered_tss_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted mse_total: </span><span class="si">{</span><span class="n">mse_total_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Should match statsmodels)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted mse_total: </span><span class="si">{</span><span class="n">mse_total_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Statsmodels Results (Weighted) ---
Mean Squared Error of the Model (mse_model): 453.2692
Mean Squared Error of the Residuals (MSE) (mse_resid): 0.3141
Total Mean Squared Error (mse_total): 65.0220

--- Manual Calculations ---
Manual Weighted mse_model: 453.2692 (Should match statsmodels)
Manual Unweighted mse_model: 105.6192

Manual Weighted mse_resid: 0.3141 (Should match statsmodels)
Manual Unweighted mse_resid: 0.1438

Manual Weighted mse_total: 65.0220 (Should match statsmodels)
Manual Unweighted mse_total: 16.6355
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unbiased Scale using results.scale</span>
<span class="n">unbiased_scale_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">scale</span> <span class="c1"># ssr / df_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unbiased Scale (statsmodels results.scale): </span><span class="si">{</span><span class="n">unbiased_scale_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Degrees of Freedom</span>
<span class="n">degrees_of_freedom</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of Freedom: </span><span class="si">{</span><span class="n">degrees_of_freedom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">rss_weighted_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ssr</span> <span class="c1"># Weighted Sum of Squared Residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Sum of Squared Residuals (statsmodels results.ssr): </span><span class="si">{</span><span class="n">rss_weighted_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">unbiased_scale_sm_rss</span> <span class="o">=</span> <span class="n">rss_weighted_sm</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unbiased Scale (weighted RSS / degrees of freedom): </span><span class="si">{</span><span class="n">unbiased_scale_sm_rss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unbiased Scale (statsmodels results.scale): 0.3141
Degrees of Freedom: 6.0
Weighted Sum of Squared Residuals (statsmodels results.ssr): 1.8848
Unbiased Scale (weighted RSS / degrees of freedom): 0.3141
</pre></div>
</div>
</div>
</div>
</section>
<section id="what-results-scale-means">
<h3>What <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> Means<a class="headerlink" href="#what-results-scale-means" title="Link to this heading">#</a></h3>
<p>In <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>, <strong><code class="docutils literal notranslate"><span class="pre">results.scale</span></code></strong> is a value that represents the estimated variance of the error term (<span class="math notranslate nohighlight">\(\sigma^2\)</span>) in the regression model. It’s calculated by dividing the <strong>Weighted Sum of Squared Residuals (<code class="docutils literal notranslate"><span class="pre">results.ssr</span></code>)</strong> (we denote this as weighted residual sum of squares (RSS)) by the <strong>degrees of freedom of the residuals (<code class="docutils literal notranslate"><span class="pre">results.df_resid</span></code>)</strong>, which is the same calculation as the <strong>Mean Squared Error of the Residuals (<code class="docutils literal notranslate"><span class="pre">results.mse_resid</span></code>)</strong>. Therefore, for a weighted least squares (WLS) model, <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> and <code class="docutils literal notranslate"><span class="pre">results.mse_resid</span></code> will have the same value.</p>
<p>NOTE: In statsmodels, results.ssr in a WLS context represents the sum of the whitened (i.e., weighted) residuals.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> parameter is crucial in regression analysis for a few key reasons:</p>
<ul>
<li><p><strong>Estimating Error Variance (estimating variance of errors) <span class="math notranslate nohighlight">\(\sigma^2\)</span>:</strong> In a WLS model, the scale is an unbiased estimator of the variance of the underlying error term. This value is used to calculate the standard errors of the regression coefficients. A smaller scale value suggests a better-fitting model, as it implies the residuals are smaller on average.</p></li>
<li><p><strong>Calculating Standard Errors:</strong> The <strong>covariance matrix</strong> of the estimated coefficients is given by:</p>
<div class="math notranslate nohighlight">
\[\text{Cov}(\hat{\beta}) = \hat{\sigma}^2 (X^T W X)^{-1}\]</div>
<p>Here, <span class="math notranslate nohighlight">\(\hat{\sigma}^2\)</span> is the estimated variance of the error term, which is precisely <code class="docutils literal notranslate"><span class="pre">results.scale</span></code>. The standard errors of the coefficients are the square roots of the diagonal elements of this covariance matrix. Without this scale factor, the standard errors would be incorrect.</p>
</li>
<li><p><strong>Hypothesis Testing:</strong> Since the t-statistic is calculated as <code class="docutils literal notranslate"><span class="pre">Estimated</span> <span class="pre">Coefficient</span> <span class="pre">/</span> <span class="pre">Standard</span> <span class="pre">Error</span></code>, and the standard error depends on <code class="docutils literal notranslate"><span class="pre">results.scale</span></code>, this value is fundamental for determining the statistical significance of the coefficients. It directly influences the <strong>t-values</strong> and <strong>p-values</strong> in the model summary.</p></li>
<li><p><strong>Addressing Heteroscedasticity:</strong> The standard Ordinary Least Squares (OLS) model assumes that the error variance is constant (homoscedasticity). Weighted Least Squares (WLS) is used specifically when this assumption is violated, a condition known as heteroscedasticity. In WLS, you provide weights that are ideally the inverse of the variance of each observation. After applying these weights, the transformed model should have constant error variance. The <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> is the estimate of this now-constant variance in the weighted model.</p></li>
<li><p><strong>Standard Error of the Regression:</strong> The square root of <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> is often referred to as the <strong>Standard Error of the Regression (SER)</strong>. This value gives you a measure of the typical distance that the observed values fall from the regression line in the units of the dependent variable (after accounting for the weighting).</p></li>
</ul>
<p>In a standard (unweighted) Ordinary Least Squares (OLS) model, the assumption is that the variance of the errors is constant and unknown (<span class="math notranslate nohighlight">\(\text{Var}(\epsilon_i) = \sigma^2\)</span>). OLS estimates this <span class="math notranslate nohighlight">\(\sigma^2\)</span> from the data using <code class="docutils literal notranslate"><span class="pre">RSS</span> <span class="pre">/</span> <span class="pre">degrees</span> <span class="pre">of</span> <span class="pre">freedom</span></code>.</p>
<p>In the context of the WLS model, <strong><code class="docutils literal notranslate"><span class="pre">results.scale</span></code> is the unbiased estimate of the variance of the weighted residuals <span class="math notranslate nohighlight">\(\sigma^2\)</span></strong>.</p>
<p>Let’s break that down:</p>
<ul class="simple">
<li><p><strong>Variance:</strong> It represents the average squared difference between the observed <code class="docutils literal notranslate"><span class="pre">y</span></code> values and the predicted <code class="docutils literal notranslate"><span class="pre">y</span></code> values (<code class="docutils literal notranslate"><span class="pre">y_hat</span></code>) on the regression line, after the weighting has been applied.</p></li>
<li><p><strong>Unbiased Estimate:</strong> You are calculating this variance from a sample, not the entire population. Dividing by the degrees of freedom (<code class="docutils literal notranslate"><span class="pre">df_resid</span></code> or <code class="docutils literal notranslate"><span class="pre">n-p</span></code>) instead of just the number of observations (<code class="docutils literal notranslate"><span class="pre">n</span></code>) corrects for the fact that you’ve already used some information from your data to estimate the model’s coefficients (the slope and intercept). This makes it an “unbiased” estimator.</p></li>
</ul>
<p>So, while weighted RSS gives you the <em>total</em> sum of the squared errors, <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> (or <code class="docutils literal notranslate"><span class="pre">mse_resid</span></code>) gives you the <em>average</em> squared error, adjusted for the number of parameters you estimated. It is the key measure of the dispersion of your data points around the fitted regression line in the transformed, weighted system.</p>
<p>In <strong>Weighted Least Squares (WLS)</strong> <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>, the assumption is that the error variances are known up to a constant factor (<span class="math notranslate nohighlight">\(\text{Var}(\epsilon_i) = \sigma_i^2 = \sigma^2 / w_i\)</span>), where <span class="math notranslate nohighlight">\(w_i\)</span> are the known weights. The <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> value provides an estimate of this unknown constant <span class="math notranslate nohighlight">\(\sigma^2\)</span>. The WLS algorithm minimizes the <strong>weighted sum of squared residuals (<code class="docutils literal notranslate"><span class="pre">results.ssr</span></code>)</strong>, and this minimized value, when divided by the degrees of freedom, gives us the best estimate for <span class="math notranslate nohighlight">\(\sigma^2\)</span> based on our model and weights.</p>
<blockquote>
<div><p>IMPORTANT: The last statement may confuse a bit. At the very beginning, we defined standard deviations <span class="math notranslate nohighlight">\(\sigma_i\)</span> for each point:</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard deviation for each data point</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
</pre></div>
</div>
<p>Then we calculated the weights based on the standard formula <span class="math notranslate nohighlight">\(w_i = 1 / \sigma_i^2\)</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The weights for WLS are the inverse of the variance (1 / sigma^2)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>However, we provide weights <span class="math notranslate nohighlight">\(w_i\)</span> array as an argument for <code class="docutils literal notranslate"><span class="pre">sm.WLS</span></code>, not sigma <span class="math notranslate nohighlight">\(\sigma_i\)</span> array (see below) because <code class="docutils literal notranslate"><span class="pre">sm.WLS</span></code> doesn’t have such a argument like <code class="docutils literal notranslate"><span class="pre">sigma</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add a constant to the independent variable to include an intercept in the model</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">wls_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">WLS</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
<p>Thus, the <code class="docutils literal notranslate"><span class="pre">sm.WLS</span></code> actually doesn’t know that we have standard deviations defined from the experiments. Therefore, the algorithm will perform its own estimate of the error variance (<span class="math notranslate nohighlight">\(\text{Var}(\epsilon_i) = \sigma_i^2 = \sigma^2 / w_i\)</span>). In this last formula <span class="math notranslate nohighlight">\(w_i\)</span> are known because we provided them to the algorithm, but <span class="math notranslate nohighlight">\(\sigma^2\)</span> is the unknown metric which is estimated by the algorithm. If the estimated value of <span class="math notranslate nohighlight">\(\sigma^2\)</span> is close to 1, then <span class="math notranslate nohighlight">\(\text{Var}(\epsilon_i)\)</span> will be close to the squared values (variance) of the original standard deviations from which we started the calculation of weights.</p>
<p>On the other hand, <code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code> can consider standard deviation values <span class="math notranslate nohighlight">\(\sigma_i\)</span> if we use <code class="docutils literal notranslate"><span class="pre">sigma</span></code> argument for the standard deviations and <code class="docutils literal notranslate"><span class="pre">absolute_sigma=True</span></code>. If <code class="docutils literal notranslate"><span class="pre">absolute_sigma=False</span></code> (the default), <code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code> treats the provided <code class="docutils literal notranslate"><span class="pre">sigma</span></code> values as relative weights to scale the residuals, and the final parameter covariance is scaled by the reduced chi-squared value. This approach is conceptually similar to statsmodels WLS, where an unknown variance scale is estimated from the residuals.</p>
<p><code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code> can be utilized for both linear and non-linear models. Also, note that <code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code> doesn’t provide you with such a number of metrics as statsmodels that we reviewed above.</p>
</section>
<section id="log-likelihood">
<h3>Log-Likelihood<a class="headerlink" href="#log-likelihood" title="Link to this heading">#</a></h3>
<p>Let’s figure out how the value of Log-Likelihood of the Model is calculated. The standard formulas for AIC and BIC can be found <a class="reference internal" href="#../aic-and-bic.ipynb"><span class="xref myst">here</span></a></p>
<p>We start with the general <a class="reference internal" href="#../aic-and-bic.ipynb"><span class="xref myst">formula</span></a>:</p>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \ln(\sqrt{2\pi\sigma_i^2}) - \frac{1}{2} \sum_{i=1}^{n} \frac{(y_i - f(x_i, \beta))^2}{\sigma_i^2}\]</div>
<p>Let’s modify it a bit using the assumptions from statsmodels. In <strong>Weighted Least Squares (WLS)</strong> <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>, the assumption is that the error variances are known up to a constant factor (<span class="math notranslate nohighlight">\(\text{Var}(\epsilon_i) = \sigma_i^2 = \sigma^2 / w_i\)</span>), where <span class="math notranslate nohighlight">\(w_i\)</span> are the known weights. The <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> value provides an estimate of this unknown constant <span class="math notranslate nohighlight">\(\sigma^2\)</span>. Therefore, we substitute</p>
<div class="math notranslate nohighlight">
\[\sigma_i^2 = \sigma^2 / w_i\]</div>
<p>in the formula for <span class="math notranslate nohighlight">\(\ln(L)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \ln\left(\sqrt{\frac{2\pi\sigma^2}{w_i}}\right) - \frac{1}{2} \sum_{i=1}^{n} \frac{w_i (y_i - f(x_i, \beta))^2}{\sigma^2}\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \ln\left(\sqrt{\frac{2\pi\sigma^2}{w_i}}\right) - \frac{1}{2 \sigma^2} \sum_{i=1}^{n} w_i (y_i - f(x_i, \beta))^2\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \frac{1}{2}\sum_{i=1}^{n} \ln\left(\frac{2\pi\sigma^2}{w_i}\right) - \frac{1}{2} \frac{RSS_w}{\sigma^2}\]</div>
<p>where <span class="math notranslate nohighlight">\(RSS_w\)</span> is weighted RSS. Note, that <span class="math notranslate nohighlight">\(RSS_w = \chi^2\)</span>.</p>
<div class="math notranslate nohighlight">
\[\ln(L) = - \frac{1}{2}\sum_{i=1}^{n} \left( \ln\left(2 \pi\right) + \ln\left(\sigma^2\right) - \ln\left(w_i\right) \right) - \frac{RSS_w}{2 \sigma^2}\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \frac{1}{2}\sum_{i=1}^{n} \ln\left(2 \pi\right) - \frac{1}{2}\sum_{i=1}^{n} \ln\left(\sigma^2\right) + \frac{1}{2}\sum_{i=1}^{n} \ln\left(w_i\right) - \frac{RSS_w}{2 \sigma^2}\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \frac{n}{2} \ln\left(2 \pi\right) - \frac{n}{2} \ln\left(\sigma^2\right) + \frac{1}{2}\sum_{i=1}^{n} \ln\left(w_i\right) - \frac{RSS_w}{2 \sigma^2}\]</div>
<p>Now, we can find the <strong>Maximum Likelihood Estimate (MLE)</strong> for the variance, denoted as <span class="math notranslate nohighlight">\(\hat{\sigma}^2\)</span>, by taking the partial derivative of the log-likelihood function with respect to <span class="math notranslate nohighlight">\(\sigma^2\)</span> and setting it to zero. The same approach is described <a class="reference internal" href="#../aic-and-bic.ipynb"><span class="xref myst">here</span></a> in more details.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \ln(L)}{\partial \sigma^2} = - \frac{n}{2\sigma^2} + \frac{RSS_w}{2(\sigma^2)^2}\]</div>
<p>Setting the derivative to zero to find the maximum:</p>
<div class="math notranslate nohighlight">
\[\frac{n}{2\hat{\sigma}^2} = \frac{RSS_w}{2(\hat{\sigma}^2)^2}\]</div>
<p>Solving for <span class="math notranslate nohighlight">\(\hat{\sigma}^2\)</span> gives us the MLE for the variance:</p>
<div class="math notranslate nohighlight">
\[\hat{\sigma}^2 = \frac{RSS_w}{n}\]</div>
<blockquote>
<div><p>This is a fundamentally important result: the maximum likelihood estimate (MLE) for the unknown variance <span class="math notranslate nohighlight">\(\sigma^2\)</span> is the weighted residual sum of squares divided by the number of data points. Note that our result is a biased estimator. Discussion about biased vs unbiased estimator can be found <a class="reference internal" href="#../aic-and-bic.ipynb"><span class="xref myst">here</span></a>.</p>
</div></blockquote>
<p>Now, we can substitute this estimate <span class="math notranslate nohighlight">\(\hat{\sigma}^2\)</span> back into the log-likelihood equation to get the <em>maximized</em> log-likelihood, <span class="math notranslate nohighlight">\(\ln(\hat{L})\)</span>. This value represents the highest possible likelihood given the data and the model form.</p>
<div class="math notranslate nohighlight">
\[\ln(\hat{L}) = - \frac{n}{2} \ln(2\pi) - \frac{n}{2} \ln\left(\frac{RSS_w}{n}\right) + \frac{1}{2}\sum_{i=1}^{n} \ln\left(w_i\right) - \frac{RSS_w}{2\left(\frac{RSS_w}{n}\right)}\]</div>
<div class="math notranslate nohighlight">
\[\ln(\hat{L}) = - \frac{n}{2} \ln(2\pi) - \frac{n}{2} \ln\left(\frac{RSS_w}{n}\right) + \frac{1}{2}\sum_{i=1}^{n} \ln\left(w_i\right) - \frac{n}{2}\]</div>
<div class="math notranslate nohighlight">
\[\ln(\hat{L}) = - \frac{n}{2} \left(\ln(2\pi) + 1\right) - \frac{n}{2} \ln\left(\frac{RSS_w}{n}\right) + \frac{1}{2}\sum_{i=1}^{n} \ln\left(w_i\right)\]</div>
<p>This is the final expression for the maximized log-likelihood when <span class="math notranslate nohighlight">\(\sigma^2\)</span> is unknown and we utilize statsmodels WLS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Information Criteria from statsmodels ---&quot;</span><span class="p">)</span>

<span class="n">llf</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">llf</span> <span class="c1"># Log-likelihood of model</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum Log-Likelihood of the Model (results.llf) from statsmodels: </span><span class="si">{</span><span class="n">llf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">aic</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">aic</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Akaike Information Criterion AIC (results.aic) from statsmodels: </span><span class="si">{</span><span class="n">aic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">bic</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">bic</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bayesian Information Criterion BIC (results.bic) from statsmodels: </span><span class="si">{</span><span class="n">bic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- Manual Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Manual Calculation Verification ---&quot;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">rss_w</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ssr</span> <span class="c1"># Weighted sum of squared residuals</span>

<span class="c1"># First, calculate the Maximum Likelihood Estimate for the scale/variance parameter</span>
<span class="n">mle_variance</span> <span class="o">=</span> <span class="n">rss_w</span> <span class="o">/</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MLE for variance (RSS_w / n): </span><span class="si">{</span><span class="n">mle_variance</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Now, use the simplified formula derived from substituting the MLE scale</span>
<span class="n">term1</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">term2</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mle_variance</span><span class="p">)</span>
<span class="n">term3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
<span class="n">llf_manual_correct</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Maximum Log-Likelihood calculated using the formula: </span><span class="si">{</span><span class="n">llf_manual_correct</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf_manual_correct</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span>  <span class="c1"># p = 2 parameters (intercept and slope)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual AIC: </span><span class="si">{</span><span class="n">aic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">bic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf_manual_correct</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual BIC: </span><span class="si">{</span><span class="n">bic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">aicc</span> <span class="o">=</span> <span class="n">aic</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual AICc (Corrected Akaike Information Criterion): </span><span class="si">{</span><span class="n">aicc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Information Criteria from statsmodels ---
Maximum Log-Likelihood of the Model (results.llf) from statsmodels: 0.0498
Akaike Information Criterion AIC (results.aic) from statsmodels: 3.9004
Bayesian Information Criterion BIC (results.bic) from statsmodels: 4.0593

--- Manual Calculation Verification ---
MLE for variance (RSS_w / n): 0.2356

Maximum Log-Likelihood calculated using the formula: 0.0498
Manual AIC: 3.9004
Manual BIC: 4.0593
Manual AICc (Corrected Akaike Information Criterion): 6.3004
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Generate and display plots ---</span>

<span class="n">residuals</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">resid</span>  <span class="c1"># Unweighted residuals</span>

<span class="n">weighted_residuals</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">wresid</span>  <span class="c1"># Weighted residuals</span>

<span class="n">weighted_sigma</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="c1"># This gives us an array with the values of 1 for each observation</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Sigma: </span><span class="si">{</span><span class="n">weighted_sigma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create a figure and axes for the plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;WLS Regression Analysis&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># --- Plot 1: WLS Fit with Confidence and Prediction Intervals ---</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data with Error Bars&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;WLS Fit&#39;</span><span class="p">)</span>

<span class="c1"># Get prediction intervals</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">prediction_summary</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># Plot confidence and prediction intervals</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;mean_ci_lower&#39;</span><span class="p">],</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;mean_ci_upper&#39;</span><span class="p">],</span> <span class="s1">&#39;g--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;obs_ci_lower&#39;</span><span class="p">],</span> <span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Prediction Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;obs_ci_upper&#39;</span><span class="p">],</span> <span class="s1">&#39;y:&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dependent Variable (y)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;WLS Fit with Confidence and Prediction Intervals&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># --- Plot 2: Residuals Plot ---</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># --- Plot 3: Weighted Residuals Plot ---</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weighted_residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">weighted_sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Weighted Sigma: [1. 1. 1. 1. 1. 1. 1. 1.]
</pre></div>
</div>
<img alt="../_images/1be0729880cc4e846041e02f774f132bebcac78231c99984ec05e19276a127b3.png" src="../_images/1be0729880cc4e846041e02f774f132bebcac78231c99984ec05e19276a127b3.png" />
</div>
</div>
</section>
<section id="confidence-and-prediction-intervals">
<h3>Confidence and Prediction Intervals<a class="headerlink" href="#confidence-and-prediction-intervals" title="Link to this heading">#</a></h3>
<p>When you use <code class="docutils literal notranslate"><span class="pre">results.get_prediction(X).summary_frame()</span></code>, you are generating confidence and prediction intervals for your model’s predictions. Here’s a breakdown of what each of these columns in the resulting DataFrame represents:</p>
</section>
<section id="confidence-interval-mean-ci-lower-and-mean-ci-upper">
<h3>Confidence Interval: <code class="docutils literal notranslate"><span class="pre">mean_ci_lower</span></code> and <code class="docutils literal notranslate"><span class="pre">mean_ci_upper</span></code><a class="headerlink" href="#confidence-interval-mean-ci-lower-and-mean-ci-upper" title="Link to this heading">#</a></h3>
<p>These two columns define the <strong>confidence interval for the mean prediction</strong>. In simpler terms, they provide a range in which the <em>average</em> value of the outcome is likely to fall for a given set of input values.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mean_ci_lower</span></code>: This is the lower bound of the 95% confidence interval for the predicted mean.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean_ci_upper</span></code>: This is the upper bound of the 95% confidence interval for the predicted mean.</p></li>
</ul>
<p>A 95% confidence interval means that if you were to repeatedly draw new samples and re-run your regression, 95% of the calculated confidence intervals would contain the TRUE average value of the population. It essentially quantifies the uncertainty around the estimated regression line itself. Additional notes:</p>
<ul class="simple">
<li><p>In frequentist statistics, the true population mean (or the true regression coefficient) is considered a fixed, single value. It does not vary.</p></li>
<li><p>Each time you draw a new random sample from the population, you will get a slightly different sample mean and, therefore, a slightly different confidence interval.</p></li>
<li><p>Imagine you and 99 other researchers all study the same phenomenon. You each collect your own random sample and each compute a 95% confidence interval. The “95% confidence” means we would expect about 95 of those 100 different confidence intervals to successfully “capture” the true, fixed population parameter. The other 5 researchers would have been unlucky and their intervals would not contain the true value. The problem is, when you do your one study, you only have your one interval. You cannot know if you are in the lucky 95% or the unlucky 5%.</p></li>
</ul>
</section>
<section id="prediction-interval-obs-ci-lower-and-obs-ci-upper">
<h3>Prediction Interval: <code class="docutils literal notranslate"><span class="pre">obs_ci_lower</span></code> and <code class="docutils literal notranslate"><span class="pre">obs_ci_upper</span></code><a class="headerlink" href="#prediction-interval-obs-ci-lower-and-obs-ci-upper" title="Link to this heading">#</a></h3>
<p>These columns define the <strong>prediction interval for a single observation</strong>. This interval is wider than the confidence interval because it accounts for two sources of uncertainty:</p>
<ol class="arabic simple">
<li><p>The uncertainty in the estimate of the mean (the regression line).</p></li>
<li><p>The inherent random variation of individual data points around the mean.</p></li>
</ol>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">obs_ci_lower</span></code>: This is the lower bound of the 95% prediction interval for a new observation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">obs_ci_upper</span></code>: This is the upper bound of the 95% prediction interval for a new observation.</p></li>
</ul>
<p>A 95% prediction interval suggests that for a new data point, there is a 95% probability that its actual value will fall within this range.</p>
<p><strong>In summary:</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Term</p></th>
<th class="head"><p>Full Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">mean_ci_lower</span></code></p></td>
<td><p>Mean Confidence Interval Lower Bound</p></td>
<td><p>The lower limit for the range where the <em>average</em> outcome is likely to be.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">mean_ci_upper</span></code></p></td>
<td><p>Mean Confidence Interval Upper Bound</p></td>
<td><p>The upper limit for the range where the <em>average</em> outcome is likely to be.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">obs_ci_lower</span></code></p></td>
<td><p>Observation Confidence Interval Lower Bound</p></td>
<td><p>The lower limit for the range where a <em>single new observation</em> is likely to fall.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">obs_ci_upper</span></code></p></td>
<td><p>Observation Confidence Interval Upper Bound</p></td>
<td><p>The upper limit for the range where a <em>single new observation</em> is likely to fall.</p></td>
</tr>
</tbody>
</table>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">alpha=0.05</span></code> argument in <code class="docutils literal notranslate"><span class="pre">summary_frame(alpha=0.05)</span></code> call is what specifies the 95% confidence level (1 - 0.05 = 0.95). You can adjust this alpha to change the width of your intervals.</p>
<p>Documentation: <a class="reference external" href="https://www.statsmodels.org/stable/examples/notebooks/generated/statespace_forecasting.html">https://www.statsmodels.org/stable/examples/notebooks/generated/statespace_forecasting.html</a></p>
</section>
<section id="comment-about-the-3rd-plot-weighted-residuals-of-the-wls-fit">
<h3>Comment about the 3rd Plot (Weighted Residuals of the WLS fit)<a class="headerlink" href="#comment-about-the-3rd-plot-weighted-residuals-of-the-wls-fit" title="Link to this heading">#</a></h3>
<p>In our <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> Weighted Least Squares (WLS) regression analysis, using <code class="docutils literal notranslate"><span class="pre">yerr=sigma</span></code> for the error bars on the <strong>weighted</strong> residuals plot is <strong>not correct</strong>. This approach misrepresents the uncertainty associated with the weighted residuals. That’s why we calculated <code class="docutils literal notranslate"><span class="pre">weighted_sigma</span> <span class="pre">=</span> <span class="pre">sigma</span> <span class="pre">*</span> <span class="pre">np.sqrt(weights)</span></code> which gives us an array populated with <code class="docutils literal notranslate"><span class="pre">1.0</span></code> values.</p>
<p>The purpose of using weighted residuals is to transform the residuals to a scale where they have a constant variance (a property known as homoscedasticity). In a correctly specified WLS model, the weighted residuals should have a theoretical variance of 1.</p>
</section>
</section>
<section id="example-2">
<h2>Example 2<a class="headerlink" href="#example-2" title="Link to this heading">#</a></h2>
<p>The only difference compared to the previous example is the initial <code class="docutils literal notranslate"><span class="pre">sigma</span></code> araay:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tools.eval_measures</span><span class="w"> </span><span class="kn">import</span> <span class="n">rmse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample data from a hypothetical physics experiment</span>
<span class="c1"># x represents an independent variable</span>
<span class="c1"># y_obs represents the observed dependent variable</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">11.8</span><span class="p">,</span> <span class="mf">14.1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Standard deviation for each data point</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The weights for WLS are the inverse of the variance (1 / sigma^2)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Add a constant to the independent variable to include an intercept in the model</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit the Weighted Least Squares model</span>
<span class="n">wls_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">WLS</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">wls_model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># --- Print the detailed summary of the regression ---</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            WLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.995
Model:                            WLS   Adj. R-squared:                  0.994
Method:                 Least Squares   F-statistic:                     1132.
Date:                Fri, 22 Aug 2025   Prob (F-statistic):           4.59e-08
Time:                        00:02:48   Log-Likelihood:                -1.0822
No. Observations:                   8   AIC:                             6.164
Df Residuals:                       6   BIC:                             6.323
Df Model:                           1                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.3393      0.249      1.361      0.222      -0.271       0.949
x1             1.6607      0.049     33.646      0.000       1.540       1.781
==============================================================================
Omnibus:                        0.129   Durbin-Watson:                   1.520
Prob(Omnibus):                  0.937   Jarque-Bera (JB):                0.298
Skew:                           0.201   Prob(JB):                        0.862
Kurtosis:                       2.144   Cond. No.                         11.5
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Output Analysis<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p><span class="math notranslate nohighlight">\(t \approx 1.361\)</span> is too low for <span class="math notranslate nohighlight">\(\beta_0\)</span> which causes the <span class="math notranslate nohighlight">\(P&gt;|t| \approx 0.222\)</span> value to be greater than the threshold for significance <span class="math notranslate nohighlight">\(\alpha=0.05\)</span>. Thus, we cannot reject the null hypothesis for <span class="math notranslate nohighlight">\(\beta_0\)</span>. Thus the obtained estimate of <span class="math notranslate nohighlight">\(\beta_0 = 0.3393\)</span> is not statistically significant. Also, as we can see from the confidence interval ([0.025 0.975]), this confidence interval from -0.271 to 0.949 contains zero value as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Degrees of Freedom</span>
<span class="n">degrees_of_freedom</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of Freedom: </span><span class="si">{</span><span class="n">degrees_of_freedom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Observations: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">condition_number</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">condition_number</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Condition Number: </span><span class="si">{</span><span class="n">condition_number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Degrees of Freedom: 6.0
Number of Observations: 8.0
Condition Number: 11.478428240732693
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_value_intercept</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Intercept: </span><span class="si">{</span><span class="n">t_value_intercept</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">t_value_slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">tvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Slope: </span><span class="si">{</span><span class="n">t_value_slope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>T-value for Intercept: 1.3612466734221584
T-value for Slope: 33.64621914609759
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_value_intercept</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Intercept: </span><span class="si">{</span><span class="n">p_value_intercept</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">p_value_slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Slope: </span><span class="si">{</span><span class="n">p_value_slope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P-value for Intercept: 0.22233728808292874
P-value for Slope: 4.588381846337238e-08
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_value_intercept_scipy</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_intercept</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># two-tailed p-value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Intercept (SciPy): </span><span class="si">{</span><span class="n">p_value_intercept_scipy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">p_value_slope_scipy</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_slope</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># two-tailed p-value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Slope (SciPy): </span><span class="si">{</span><span class="n">p_value_slope_scipy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>P-value for Intercept (SciPy): 0.22233728808292874
P-value for Slope (SciPy): 4.588381846337238e-08
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- 1) Calculate RSS using results.resid (unweighted residuals) ---</span>
<span class="n">rss_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">resid</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;1) RSS from unweighted residuals (results.resid): </span><span class="si">{</span><span class="n">rss_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- 2) Calculate RSS using results.wresid (weighted residuals) ---</span>
<span class="c1"># This is the value that WLS minimizes.</span>
<span class="n">rss_weighted_from_wresid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">wresid</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;2) Weighted RSS from weighted residuals (results.wresid): </span><span class="si">{</span><span class="n">rss_weighted_from_wresid</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">rss_weighted_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ssr</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;3) Weighted RSS from results.ssr: </span><span class="si">{</span><span class="n">rss_weighted_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- 3) Calculate RSS manually using the linear equation ---</span>
<span class="c1"># Get the coefficients from the model results</span>
<span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span>
<span class="c1"># Calculate the predicted y values</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">intercept</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x</span>
<span class="c1"># Calculate the residuals manually</span>
<span class="n">manual_residuals</span> <span class="o">=</span> <span class="n">y_obs</span> <span class="o">-</span> <span class="n">y_pred</span>
<span class="c1"># Square and sum the residuals</span>
<span class="n">rss_unweighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">manual_residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;4) Manually calculated RSS (unweighted): </span><span class="si">{</span><span class="n">rss_unweighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- 4) Calculate weighted RSS manually ---</span>
<span class="c1"># Use the manual residuals and the weights</span>
<span class="n">manual_weighted_residuals_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">manual_residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">weights</span>
<span class="n">rss_weighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">manual_weighted_residuals_sq</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;5) Manually calculated Weighted RSS: </span><span class="si">{</span><span class="n">rss_weighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Verification ---</span>
<span class="c1"># Note that the unweighted RSS values from (1) and (3) should be identical.</span>
<span class="c1"># The weighted RSS values from (2) and (4) should also be identical.</span>
<span class="c1"># The small differences might occur due to floating-point precision.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1) RSS from unweighted residuals (results.resid): 0.6139
2) Weighted RSS from weighted residuals (results.wresid): 2.4557
3) Weighted RSS from results.ssr: 2.4557
4) Manually calculated RSS (unweighted): 0.6139
5) Manually calculated Weighted RSS: 2.4557
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) print tss value using results.centered_tss</span>
<span class="n">centered_tss_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total weighted sum of squares centered about the mean (statsmodels results.centered_tss): </span><span class="si">{</span><span class="n">centered_tss_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 2) print tss value using results.uncentered_tss</span>
<span class="n">uncentered_tss_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">uncentered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uncentered total weighted sum of squares (statsmodels results.uncentered_tss): </span><span class="si">{</span><span class="n">uncentered_tss_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 3) calculate centered_tss manually</span>
<span class="c1"># First, calculate the weighted mean of y_obs</span>
<span class="n">weighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="c1"># Then, calculate the centered_tss using the formula</span>
<span class="n">weighted_centered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual calculation of total (weighted) sum of squares centered about the mean: </span><span class="si">{</span><span class="n">weighted_centered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 4) calculate uncentered_tss manually</span>
<span class="c1"># The formula is the sum of weighted squared y values</span>
<span class="n">weighted_uncentered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual calculation of uncentered total (weighted) sum of squares: </span><span class="si">{</span><span class="n">weighted_uncentered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual Unweighted Calculations ---</span>

<span class="c1"># 5) calculate unweighted centered_tss manually</span>
<span class="c1"># First, calculate the standard (unweighted) mean of y_obs</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="c1"># Then, calculate the unweighted centered_tss</span>
<span class="c1"># Formula: sum((y_obs - mean(y_obs))^2)</span>
<span class="n">unweighted_centered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual calculation of unweighted TSS centered about the mean: </span><span class="si">{</span><span class="n">unweighted_centered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 6) calculate unweighted uncentered_tss manually</span>
<span class="c1"># The formula is the sum of squared y values without weighting</span>
<span class="c1"># Formula: sum(y_obs^2)</span>
<span class="n">unweighted_uncentered_tss_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_obs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual calculation of uncentered unweighted TSS: </span><span class="si">{</span><span class="n">unweighted_uncentered_tss_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total weighted sum of squares centered about the mean (statsmodels results.centered_tss): 465.7950
Uncentered total weighted sum of squares (statsmodels results.uncentered_tss): 2418.9200

Manual calculation of total (weighted) sum of squares centered about the mean: 465.7950
Manual calculation of uncentered total (weighted) sum of squares: 2418.9200

Manual calculation of unweighted TSS centered about the mean: 116.4488
Manual calculation of uncentered unweighted TSS: 604.7300
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ess</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ess</span> <span class="c1"># The explained sum of squares.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Explained Sum of Squares (ESS): </span><span class="si">{</span><span class="n">ess</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manually calculate the ESS</span>
<span class="c1"># Get the fitted values (y_hat) from the model</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Calculate the weighted mean of y_obs</span>
<span class="n">weighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

<span class="c1"># Calculate ESS using the formula: sum(weights * (y_hat - weighted_mean_y)^2)</span>
<span class="n">ess_weighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_hat</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Explained Sum of Squares (ESS) manual calculation: </span><span class="si">{</span><span class="n">ess_weighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Calculate the unweighted mean of y_obs</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># Finally, calculate the unweighted ESS using the formula: sum((y_hat - unweighted_mean_y)^2)</span>
<span class="n">ess_unweighted_manual</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_hat</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Explained Sum of Squares (ESS) unweighted manual calculation: </span><span class="si">{</span><span class="n">ess_unweighted_manual</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Weighted Explained Sum of Squares (ESS): 463.3393
Weighted Explained Sum of Squares (ESS) manual calculation: 463.3393
Explained Sum of Squares (ESS) unweighted manual calculation: 115.8348
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the number of observations and parameters</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># df_model is number of explanatory variables, add 1 for intercept</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of observations (n): </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of parameters (p): </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of observations (n): 8.0
Number of parameters (p): 2.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r_squared</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted R-squared (statsmodels results.rsquared): </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">r_squared_adj</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared_adj</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Adjusted R-squared (statsmodels results.rsquared_adj): </span><span class="si">{</span><span class="n">r_squared_adj</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual calculation of Weighted R-squared ---</span>

<span class="n">r_squared_manual_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="n">weighted_centered_tss_manual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted R-squared (1 - RSS_w/TSS_w): </span><span class="si">{</span><span class="n">r_squared_manual_weighted</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Weighted Adjusted R-squared</span>
<span class="c1"># Formula: 1 - (1 - R^2_w) * ((n-1)/(n-p))</span>
<span class="n">r_squared_adj_manual_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_manual_weighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_manual_weighted</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual calculation of Unweighted R-squared ---</span>
<span class="c1"># We need to calculate the unweighted centered TSS first</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="n">unweighted_centered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">r_squared_manual_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="n">unweighted_centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Unweighted R-squared (1 - RSS/TSS): </span><span class="si">{</span><span class="n">r_squared_manual_unweighted</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Unweighted Adjusted R-squared</span>
<span class="c1"># Formula: 1 - (1 - R^2_unweighted) * ((n-1)/(n-p))</span>
<span class="n">r_squared_adj_manual_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_manual_unweighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_manual_unweighted</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Formula: ESS_weighted / TSS_centered_weighted</span>
<span class="n">r_squared_manual_weighted_2</span> <span class="o">=</span> <span class="n">ess_weighted_manual</span> <span class="o">/</span> <span class="n">weighted_centered_tss_manual</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted R-squared (alternative formula) (ESS_w/TSS_w): </span><span class="si">{</span><span class="n">r_squared_manual_weighted_2</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Formula: ESS_unweighted / TSS_centered_unweighted</span>
<span class="n">r_squared_manual_unweighted_2</span> <span class="o">=</span> <span class="n">ess_unweighted_manual</span> <span class="o">/</span> <span class="n">unweighted_centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted R-squared alternative formula (ESS/TSS): </span><span class="si">{</span><span class="n">r_squared_manual_unweighted_2</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Weighted R-squared (statsmodels results.rsquared): 0.994728
Weighted Adjusted R-squared (statsmodels results.rsquared_adj): 0.993849

Manual Weighted R-squared (1 - RSS_w/TSS_w): 0.994728
Manual Weighted Adjusted R-squared: 0.993849

Manual Unweighted R-squared (1 - RSS/TSS): 0.994728
Manual Unweighted Adjusted R-squared: 0.993849

Manual Weighted R-squared (alternative formula) (ESS_w/TSS_w): 0.994728
Manual Unweighted R-squared alternative formula (ESS/TSS): 0.994728
</pre></div>
</div>
</div>
</div>
<p>NOTE: When all of the <span class="math notranslate nohighlight">\(\sigma_i\)</span> values are the same, weighted and unweighted versions of R-squared and Adjusted R-square have the same values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Chi-Squared</span>
<span class="n">chi_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">())</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi-Squared: </span><span class="si">{</span><span class="n">chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Reduced Chi-Squared</span>
<span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">chi_squared</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced Chi-Squared: </span><span class="si">{</span><span class="n">reduced_chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chi-Squared: 2.4557
Reduced Chi-Squared: 0.4093
</pre></div>
</div>
</div>
</div>
<p>NOTE: While the estimated value of <span class="math notranslate nohighlight">\(\beta_0\)</span> is not statistically significant, Reduced Chi-Squared value is low and less than 1 which is good. This means that probably our standard deviations (measurement uncertainties) are overestimated.</p>
<p>If we can increase the accuracy of our measurements and decrease measurement uncertainties from 0.5 to, for example, 0.3, the reduced chi-squared value will be increased but it doesn’t necessarily change the <span class="math notranslate nohighlight">\(P&gt;|t|\)</span> value for <span class="math notranslate nohighlight">\(\beta_0\)</span> (you can open this code in Google Colab using the appropriate icon in the top Action pane, try to change all the <code class="docutils literal notranslate"><span class="pre">sigma</span></code> values from 0.5 to 0.3 and double-check that this will not affect anything related to <span class="math notranslate nohighlight">\(\beta_0\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Root Mean Squared Error (RMSE) Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Root Mean Squared Error (RMSE) ---&quot;</span><span class="p">)</span>

<span class="c1"># RMSE from statsmodels (this is an unweighted RMSE)</span>
<span class="n">rmse_val</span> <span class="o">=</span> <span class="n">rmse</span><span class="p">(</span><span class="n">y_obs</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE (statsmodels.tools.eval_measures.rmse method): </span><span class="si">{</span><span class="n">rmse_val</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Unweighted RMSE</span>
<span class="c1"># Formula: sqrt(sum of squared unweighted residuals / number of observations)</span>
<span class="n">rmse_manual_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted RMSE: </span><span class="si">{</span><span class="n">rmse_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Weighted RMSE</span>
<span class="c1"># Formula: sqrt(sum of squared weighted residuals / sum of weights)</span>
<span class="n">rmse_manual_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted RMSE: </span><span class="si">{</span><span class="n">rmse_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Root Mean Squared Error (RMSE) ---
RMSE (statsmodels.tools.eval_measures.rmse method): 0.2770
Manual Unweighted RMSE: 0.2770
Manual Weighted RMSE: 0.2770
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Standard Error of the Regression (SER) Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Standard Error of the Regression (SER) ---&quot;</span><span class="p">)</span>

<span class="c1"># SER from statsmodels results (this is a weighted SER)</span>
<span class="c1"># It is the square root of the weighted RSS divided by the degrees of freedom</span>
<span class="n">ser_sm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">ssr</span> <span class="o">/</span> <span class="n">results</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SER (from statsmodels results): </span><span class="si">{</span><span class="n">ser_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Weighted SER</span>
<span class="c1"># This should match the value from statsmodels</span>
<span class="c1"># Formula: sqrt(sum of squared weighted residuals / degrees of freedom)</span>
<span class="n">ser_manual_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted SER: </span><span class="si">{</span><span class="n">ser_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Manual calculation of Unweighted SER</span>
<span class="c1"># Formula: sqrt(sum of squared unweighted residuals / degrees of freedom)</span>
<span class="n">ser_manual_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted SER: </span><span class="si">{</span><span class="n">ser_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Standard Error of the Regression (SER) ---
SER (from statsmodels results): 0.6398
Manual Weighted SER: 0.6398
Manual Unweighted SER: 0.3199
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># --- MSE values from statsmodels results ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Statsmodels Results (Weighted) ---&quot;</span><span class="p">)</span>
<span class="n">mse_model_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">mse_model</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Squared Error of the Model (mse_model): </span><span class="si">{</span><span class="n">mse_model_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">mse_resid_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">mse_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Squared Error of the Residuals (MSE) (mse_resid): </span><span class="si">{</span><span class="n">mse_resid_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">mse_total_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">mse_total</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Mean Squared Error (mse_total): </span><span class="si">{</span><span class="n">mse_total_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Manual Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Manual Calculations ---&quot;</span><span class="p">)</span>

<span class="c1"># 1. MSE Model</span>
<span class="n">mse_model_manual_weighted</span> <span class="o">=</span> <span class="n">ess_weighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_model_manual_unweighted</span> <span class="o">=</span> <span class="n">ess_unweighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted mse_model: </span><span class="si">{</span><span class="n">mse_model_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Should match statsmodels)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted mse_model: </span><span class="si">{</span><span class="n">mse_model_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 2. MSE Residuals</span>
<span class="n">mse_resid_manual_weighted</span> <span class="o">=</span> <span class="n">rss_weighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
<span class="n">mse_resid_manual_unweighted</span> <span class="o">=</span> <span class="n">rss_unweighted_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted mse_resid: </span><span class="si">{</span><span class="n">mse_resid_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Should match statsmodels)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted mse_resid: </span><span class="si">{</span><span class="n">mse_resid_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 3. MSE Total</span>
<span class="n">mse_total_manual_weighted</span> <span class="o">=</span> <span class="n">weighted_centered_tss_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_total_manual_unweighted</span> <span class="o">=</span> <span class="n">unweighted_centered_tss_manual</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted mse_total: </span><span class="si">{</span><span class="n">mse_total_manual_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> (Should match statsmodels)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Unweighted mse_total: </span><span class="si">{</span><span class="n">mse_total_manual_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Statsmodels Results (Weighted) ---
Mean Squared Error of the Model (mse_model): 463.3393
Mean Squared Error of the Residuals (MSE) (mse_resid): 0.4093
Total Mean Squared Error (mse_total): 66.5421

--- Manual Calculations ---
Manual Weighted mse_model: 463.3393 (Should match statsmodels)
Manual Unweighted mse_model: 115.8348

Manual Weighted mse_resid: 0.4093 (Should match statsmodels)
Manual Unweighted mse_resid: 0.1023

Manual Weighted mse_total: 66.5421 (Should match statsmodels)
Manual Unweighted mse_total: 16.6355
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unbiased Scale using results.scale</span>
<span class="n">unbiased_scale_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">scale</span> <span class="c1"># ssr / df_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unbiased Scale (statsmodels results.scale): </span><span class="si">{</span><span class="n">unbiased_scale_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Degrees of Freedom</span>
<span class="n">degrees_of_freedom</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_resid</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of Freedom: </span><span class="si">{</span><span class="n">degrees_of_freedom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">rss_weighted_sm</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ssr</span> <span class="c1"># Weighted Sum of Squared Residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Sum of Squared Residuals (statsmodels results.ssr): </span><span class="si">{</span><span class="n">rss_weighted_sm</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">unbiased_scale_sm_rss</span> <span class="o">=</span> <span class="n">rss_weighted_sm</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unbiased Scale (weighted RSS / degrees of freedom): </span><span class="si">{</span><span class="n">unbiased_scale_sm_rss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unbiased Scale (statsmodels results.scale): 0.4093
Degrees of Freedom: 6.0
Weighted Sum of Squared Residuals (statsmodels results.ssr): 2.4557
Unbiased Scale (weighted RSS / degrees of freedom): 0.4093
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Information Criteria from statsmodels ---&quot;</span><span class="p">)</span>

<span class="n">llf</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">llf</span> <span class="c1"># Log-likelihood of model</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum Log-Likelihood of the Model (results.llf) from statsmodels: </span><span class="si">{</span><span class="n">llf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">aic</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">aic</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Akaike Information Criterion AIC (results.aic) from statsmodels: </span><span class="si">{</span><span class="n">aic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">bic</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">bic</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bayesian Information Criterion BIC (results.bic) from statsmodels: </span><span class="si">{</span><span class="n">bic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># --- Manual Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Manual Calculation Verification ---&quot;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">nobs</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">df_model</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">rss_w</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">ssr</span> <span class="c1"># Weighted sum of squared residuals</span>

<span class="c1"># First, calculate the Maximum Likelihood Estimate for the scale/variance parameter</span>
<span class="n">mle_variance</span> <span class="o">=</span> <span class="n">rss_w</span> <span class="o">/</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MLE for variance (RSS_w / n): </span><span class="si">{</span><span class="n">mle_variance</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Now, use the simplified formula derived from substituting the MLE scale</span>
<span class="n">term1</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">term2</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mle_variance</span><span class="p">)</span>
<span class="n">term3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
<span class="n">llf_manual_correct</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Maximum Log-Likelihood calculated using the formula: </span><span class="si">{</span><span class="n">llf_manual_correct</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf_manual_correct</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span>  <span class="c1"># p = 2 parameters (intercept and slope)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual AIC: </span><span class="si">{</span><span class="n">aic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">bic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf_manual_correct</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual BIC: </span><span class="si">{</span><span class="n">bic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">aicc</span> <span class="o">=</span> <span class="n">aic</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual AICc (Corrected Akaike Information Criterion): </span><span class="si">{</span><span class="n">aicc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Information Criteria from statsmodels ---
Maximum Log-Likelihood of the Model (results.llf) from statsmodels: -1.0822
Akaike Information Criterion AIC (results.aic) from statsmodels: 6.1645
Bayesian Information Criterion BIC (results.bic) from statsmodels: 6.3234

--- Manual Calculation Verification ---
MLE for variance (RSS_w / n): 0.3070

Maximum Log-Likelihood calculated using the formula: -1.0822
Manual AIC: 6.1645
Manual BIC: 6.3234
Manual AICc (Corrected Akaike Information Criterion): 8.5645
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Generate and display plots ---</span>

<span class="n">residuals</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">resid</span>  <span class="c1"># Unweighted residuals</span>

<span class="n">weighted_residuals</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">wresid</span>  <span class="c1"># Weighted residuals</span>

<span class="n">weighted_sigma</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span> <span class="c1"># This gives us an array with the values of 1 for each observation</span>


<span class="c1"># Create a figure and axes for the plots</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;WLS Regression Analysis&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># --- Plot 1: WLS Fit with Confidence and Prediction Intervals ---</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data with Error Bars&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;WLS Fit&#39;</span><span class="p">)</span>

<span class="c1"># Get prediction intervals</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">get_prediction</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">prediction_summary</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># Plot confidence and prediction intervals</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;mean_ci_lower&#39;</span><span class="p">],</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;mean_ci_upper&#39;</span><span class="p">],</span> <span class="s1">&#39;g--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;obs_ci_lower&#39;</span><span class="p">],</span> <span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Prediction Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">prediction_summary</span><span class="p">[</span><span class="s1">&#39;obs_ci_upper&#39;</span><span class="p">],</span> <span class="s1">&#39;y:&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dependent Variable (y)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;WLS Fit with Confidence and Prediction Intervals&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># --- Plot 2: Residuals Plot ---</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># --- Plot 3: Weighted Residuals Plot ---</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weighted_residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">weighted_sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/af64283db91a8190e01eace02a25f2103dba398d06b9f360714e31260ff3c03c.png" src="../_images/af64283db91a8190e01eace02a25f2103dba398d06b9f360714e31260ff3c03c.png" />
</div>
</div>
</section>
</section>
<section id="example-3">
<h2>Example 3<a class="headerlink" href="#example-3" title="Link to this heading">#</a></h2>
<p>We will model the same case but using <code class="docutils literal notranslate"><span class="pre">scipy</span></code> library and <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> method from that library. The <code class="docutils literal notranslate"><span class="pre">sigma</span></code> values are the same as in Example 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sample data from a hypothetical physics experiment</span>
<span class="c1"># x represents an independent variable</span>
<span class="c1"># y_obs represents the observed dependent variable</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.3</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">8.2</span><span class="p">,</span> <span class="mf">10.3</span><span class="p">,</span> <span class="mf">11.8</span><span class="p">,</span> <span class="mf">14.1</span><span class="p">])</span>

<span class="c1"># Standard deviation for each data point</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span>
<span class="c1"># The weights for WLS are the inverse of the variance (1 / sigma^2)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the linear model function for curve_fit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">linear_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">b0</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<section id="absolute-sigma-parameter">
<h3>Absolute sigma parameter<a class="headerlink" href="#absolute-sigma-parameter" title="Link to this heading">#</a></h3>
<p>Note, that <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> provides the same result for standard errors as <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> approach in a case if <code class="docutils literal notranslate"><span class="pre">absolute_sigma=False</span></code>. However, if <code class="docutils literal notranslate"><span class="pre">absolute_sigma=True</span></code>, the estimated values of intercept <span class="math notranslate nohighlight">\(\beta_0\)</span> and slope <span class="math notranslate nohighlight">\(\beta_1\)</span> do not change, but standard errors become different. This is because if <code class="docutils literal notranslate"><span class="pre">absolute_sigma=True</span></code>, then <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> considers <code class="docutils literal notranslate"><span class="pre">sigma</span></code> not just for calculating the weights; it considers <code class="docutils literal notranslate"><span class="pre">sigma</span></code> as standard deviations of measurements that should not be reestimated again.</p>
<p>below, we will proceed with both cases to compare the results between both options and between <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> and <code class="docutils literal notranslate"><span class="pre">scipy</span></code> in general.</p>
</section>
<section id="absolute-sigma-false">
<h3><code class="docutils literal notranslate"><span class="pre">absolute_sigma=False</span></code><a class="headerlink" href="#absolute-sigma-false" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Fit the model using scipy.optimize.curve_fit ---</span>
<span class="c1"># popt: Optimal values for the parameters (b0, b1)</span>
<span class="c1"># pcov: The estimated covariance matrix of popt</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">linear_func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">absolute_sigma</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Standard errors are the sqrt of the diagonal of the covariance matrix</span>
<span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span>
<span class="n">std_err_intercept</span> <span class="o">=</span> <span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">std_err_slope</span> <span class="o">=</span> <span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Extract the fitted parameters (intercept and slope)</span>
<span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="n">popt</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Fitted Parameters ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Intercept (beta_0): </span><span class="si">{</span><span class="n">intercept</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">std_err_intercept</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slope (beta_1): </span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">std_err_slope</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Fitted Parameters ---
Intercept (beta_0): 0.6375 +/- 0.1255
Slope (beta_1): 1.5857 +/- 0.0417
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check condition number of the covariance matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Condition number of the covariance matrix: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">pcov</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Condition number of the covariance matrix: 28.17
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Calculate Model Predictions and Residuals ---</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">linear_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">)</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y_obs</span> <span class="o">-</span> <span class="n">y_pred</span>
<span class="n">weighted_residuals</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span> <span class="c1"># same as residuals * sqrt(weights)</span>

<span class="c1"># --- Basic Fit Information ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Basic Fit Information ---&quot;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Number of observations</span>
<span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">popt</span><span class="p">)</span> <span class="c1"># Number of parameters (intercept, slope)</span>
<span class="n">degrees_of_freedom</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="c1"># Degrees of Freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Observations (n): </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Parameters (p): </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of Freedom (degrees_of_freedom): </span><span class="si">{</span><span class="n">degrees_of_freedom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Basic Fit Information ---
Number of Observations (n): 8
Number of Parameters (p): 2
Degrees of Freedom (degrees_of_freedom): 6
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Hypothesis Testing: t-values and p-values ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Hypothesis Testing ---&quot;</span><span class="p">)</span>

<span class="c1"># Calculate t-values</span>
<span class="n">t_value_intercept</span> <span class="o">=</span> <span class="n">intercept</span> <span class="o">/</span> <span class="n">std_err_intercept</span>
<span class="n">t_value_slope</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">/</span> <span class="n">std_err_slope</span>

<span class="c1"># Calculate two-tailed p-values</span>
<span class="n">p_value_intercept</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_intercept</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">p_value_slope</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_slope</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error for Intercept: </span><span class="si">{</span><span class="n">std_err_intercept</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Intercept: </span><span class="si">{</span><span class="n">t_value_intercept</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Intercept: </span><span class="si">{</span><span class="n">p_value_intercept</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error for Slope: </span><span class="si">{</span><span class="n">std_err_slope</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Slope: </span><span class="si">{</span><span class="n">t_value_slope</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Slope: </span><span class="si">{</span><span class="n">p_value_slope</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Hypothesis Testing ---
Standard Error for Intercept: 0.125542
T-value for Intercept: 5.078178
P-value for Intercept: 0.002270
Standard Error for Slope: 0.041745
T-value for Slope: 37.985584
P-value for Slope: 0.000000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Sum of Squares Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Sum of Squares (SS) ---&quot;</span><span class="p">)</span>
<span class="c1"># Residual Sum of Squares (RSS)</span>
<span class="n">rss_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rss_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weighted_residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># This is also the Chi-Squared value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Residual Sum of Squares (Weighted RSS): </span><span class="si">{</span><span class="n">rss_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Residual Sum of Squares (RSS): </span><span class="si">{</span><span class="n">rss_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Total Sum of Squares (TSS)</span>
<span class="n">weighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="n">weighted_centered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">unweighted_centered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Centered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">weighted_centered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Centered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">unweighted_centered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Uncentered Total Sum of Squares (TSS)</span>
<span class="n">weighted_uncentered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_obs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">unweighted_uncentered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Uncentered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">weighted_uncentered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Uncentered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">unweighted_uncentered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Explained Sum of Squares (ESS)</span>
<span class="n">ess_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ess_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Explained Sum of Squares (ESS): </span><span class="si">{</span><span class="n">ess_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Explained Sum of Squares (ESS): </span><span class="si">{</span><span class="n">ess_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Sum of Squares (SS) ---

Weighted Residual Sum of Squares (Weighted RSS): 1.8848
Unweighted Residual Sum of Squares (RSS): 0.8626

Weighted Centered Total Sum of Squares (TSS): 455.1540
Unweighted Centered Total Sum of Squares (TSS): 116.4488

Weighted Uncentered Total Sum of Squares (TSS): 1511.9919
Unweighted Uncentered Total Sum of Squares (TSS): 604.7300

Weighted Explained Sum of Squares (ESS): 453.2692
Unweighted Explained Sum of Squares (ESS): 105.6192
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Goodness-of-Fit Metrics ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Goodness-of-Fit ---&quot;</span><span class="p">)</span>

<span class="c1"># R-squared</span>
<span class="n">r_squared_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_weighted</span> <span class="o">/</span> <span class="n">weighted_centered_tss</span>
<span class="n">r_squared_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_unweighted</span> <span class="o">/</span> <span class="n">unweighted_centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted R-squared: </span><span class="si">{</span><span class="n">r_squared_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted R-squared: </span><span class="si">{</span><span class="n">r_squared_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Adjusted R-squared</span>
<span class="n">r_squared_adj_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_weighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="n">r_squared_adj_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_unweighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Chi-Squared and Reduced Chi-Squared</span>
<span class="n">chi_squared</span> <span class="o">=</span> <span class="n">rss_weighted</span> <span class="c1"># By definition</span>
<span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">chi_squared</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Chi-Squared: </span><span class="si">{</span><span class="n">chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced Chi-Squared (RSS_weighted / degrees_of_freedom): </span><span class="si">{</span><span class="n">reduced_chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Goodness-of-Fit ---

Weighted R-squared: 0.9959
Unweighted R-squared: 0.9926

Weighted Adjusted R-squared: 0.9952
Unweighted Adjusted R-squared: 0.9914

Chi-Squared: 1.8848
Reduced Chi-Squared (RSS_weighted / degrees_of_freedom): 0.3141
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Error Metrics ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Error Metrics ---&quot;</span><span class="p">)</span>
<span class="c1"># Root Mean Squared Error (RMSE)</span>
<span class="n">rmse_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
<span class="n">rmse_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unweighted RMSE: </span><span class="si">{</span><span class="n">rmse_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted RMSE: </span><span class="si">{</span><span class="n">rmse_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Standard Error of the Regression (SER)</span>
<span class="n">ser_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span>
<span class="n">ser_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="c1"># Same as sqrt of reduced_chi_squared</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unweighted SER: </span><span class="si">{</span><span class="n">ser_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted SER: </span><span class="si">{</span><span class="n">ser_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Mean Squared Errors (MSE) ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Mean Squared Errors (MSE) ---&quot;</span><span class="p">)</span>
<span class="n">mse_model_weighted</span> <span class="o">=</span> <span class="n">ess_weighted</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_resid_weighted</span> <span class="o">=</span> <span class="n">rss_weighted</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="c1"># Same as reduced chi-squared</span>
<span class="n">mse_total_weighted</span> <span class="o">=</span> <span class="n">weighted_centered_tss</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Mean Squared Error (MSE): </span><span class="si">{</span><span class="n">mse_model_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Residual MSE: </span><span class="si">{</span><span class="n">mse_resid_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted Total MSE: </span><span class="si">{</span><span class="n">mse_total_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Error Metrics ---

Unweighted RMSE: 0.3284
Weighted RMSE: 0.1869

Unweighted SER: 0.3792
Weighted SER: 0.5605

--- Mean Squared Errors (MSE) ---

Weighted Mean Squared Error (MSE): 453.2692
Weighted Residual MSE: 0.3141
Weighted Total MSE: 65.0220
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Log-Likelihood and Information Criteria ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Log-Likelihood &amp; Information Criteria ---&quot;</span><span class="p">)</span>
<span class="c1"># Since absolute_sigma=False, we assume sigma is not known, but the weights are known.</span>

<span class="c1"># First, calculate the Maximum Likelihood Estimate for the scale/variance parameter</span>
<span class="n">mle_variance</span> <span class="o">=</span> <span class="n">rss_weighted</span> <span class="o">/</span> <span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MLE for variance (RSS_weighted / n): </span><span class="si">{</span><span class="n">mle_variance</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">term1</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">term2</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mle_variance</span><span class="p">)</span>
<span class="n">term3</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
<span class="n">llf</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum Log-Likelihood: </span><span class="si">{</span><span class="n">llf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Information Criteria</span>
<span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span>
<span class="n">bic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<span class="n">aicc</span> <span class="o">=</span> <span class="n">aic</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC (Akaike Information Criterion): </span><span class="si">{</span><span class="n">aic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC (Bayesian Information Criterion): </span><span class="si">{</span><span class="n">bic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AICc (Corrected AIC): </span><span class="si">{</span><span class="n">aicc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Log-Likelihood &amp; Information Criteria ---
MLE for variance (RSS_weighted / n): 0.2356
Maximum Log-Likelihood: 0.0498
AIC (Akaike Information Criterion): 3.9004
BIC (Bayesian Information Criterion): 4.0593
AICc (Corrected AIC): 6.3004
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Generate and display plots ---</span>
<span class="c1"># Create a matrix X for manual calculation of intervals</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># --- Calculate Confidence and Prediction Intervals Manually ---</span>
<span class="c1"># Critical t-value for 95% confidence</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">t_crit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span>

<span class="c1"># 1. Confidence Interval for the mean response</span>
<span class="c1"># SE(y_hat) = sqrt(diag(X @ pcov @ X.T))</span>
<span class="n">se_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">pcov</span> <span class="o">@</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">ci_lower</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">-</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_mean</span>
<span class="n">ci_upper</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_mean</span>

<span class="c1"># 2. Prediction Interval for a new observation</span>
<span class="c1"># PI = y_hat +/- t * sqrt(sigma_i^2 + SE(y_hat)^2)</span>
<span class="c1"># Here sigma_i is the std dev of the individual point</span>
<span class="n">se_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">se_mean</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pi_lower</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">-</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_pred</span>
<span class="n">pi_upper</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_pred</span>

<span class="c1"># --- Plotting ---</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;WLS Regression Analysis with SciPy&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Plot 1: WLS Fit with Confidence and Prediction Intervals</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data with Error Bars&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;WLS Fit&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ci_lower</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ci_upper</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pi_lower</span><span class="p">,</span> <span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Prediction Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pi_upper</span><span class="p">,</span> <span class="s1">&#39;y:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dependent Variable (y)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;WLS Fit with Confidence and Prediction Intervals&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot 2: Residuals Plot</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals (y_obs - y_pred)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot 3: Weighted Residuals Plot</span>
<span class="c1"># The error on the weighted residuals is 1.0 because they are normalized by sigma.</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weighted_residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/caf17dee0b3bf388a21c566eff1c30ea5dc973f2cdd789ecf1a3e760c72b0ca1.png" src="../_images/caf17dee0b3bf388a21c566eff1c30ea5dc973f2cdd789ecf1a3e760c72b0ca1.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The 95% prediction interval looks different on these graphs compared to the results from the <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>. The higher <span class="math notranslate nohighlight">\(x\)</span> variable value, the higher width of the 95% prediction interval in our last graph. This is not the same as for <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code> case.</p>
<p>The topic of prediction intervals is not considered here but probably these details will be added later.</p>
<p>What you can do for now:</p>
<ul class="simple">
<li><p>Try to open this whole code in Google Colab using the appropriate icon in the Action pane of this page</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">sigma</span></code> array to the following <code class="docutils literal notranslate"><span class="pre">sigma</span> <span class="pre">=</span> <span class="pre">np.array([0.2,</span> <span class="pre">0.3,</span> <span class="pre">0.4,</span> <span class="pre">0.9,</span> <span class="pre">0.9,</span> <span class="pre">0.4,</span> <span class="pre">0.5,</span> <span class="pre">0.4])</span></code> and see how it will impact prediction interval on the graph.</p></li>
</ul>
</div>
</section>
<section id="absolute-sigma-true">
<h3><code class="docutils literal notranslate"><span class="pre">absolute_sigma=True</span></code><a class="headerlink" href="#absolute-sigma-true" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Fit the model using scipy.optimize.curve_fit ---</span>
<span class="c1"># popt: Optimal values for the parameters (b0, b1)</span>
<span class="c1"># pcov: The estimated covariance matrix of popt</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">linear_func</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">absolute_sigma</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Standard errors are the sqrt of the diagonal of the covariance matrix</span>
<span class="n">perr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">pcov</span><span class="p">))</span>
<span class="n">std_err_intercept</span> <span class="o">=</span> <span class="n">perr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">std_err_slope</span> <span class="o">=</span> <span class="n">perr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># Extract the fitted parameters (intercept and slope)</span>
<span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span> <span class="o">=</span> <span class="n">popt</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Fitted Parameters ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Intercept (beta_0): </span><span class="si">{</span><span class="n">intercept</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">std_err_intercept</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slope (beta_1): </span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">std_err_slope</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Fitted Parameters ---
Intercept (beta_0): 0.6375 +/- 0.2240
Slope (beta_1): 1.5857 +/- 0.0745
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check condition number of the covariance matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Condition number of the covariance matrix: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">pcov</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Condition number of the covariance matrix: 28.17
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Calculate Model Predictions and Residuals ---</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">linear_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">slope</span><span class="p">)</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y_obs</span> <span class="o">-</span> <span class="n">y_pred</span>
<span class="n">weighted_residuals</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span> <span class="c1"># same as residuals * sqrt(weights)</span>

<span class="c1"># --- Basic Fit Information ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Basic Fit Information ---&quot;</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Number of observations</span>
<span class="n">p</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">popt</span><span class="p">)</span> <span class="c1"># Number of parameters (intercept, slope)</span>
<span class="n">degrees_of_freedom</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="c1"># Degrees of Freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Observations (n): </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Parameters (p): </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Degrees of Freedom (degrees_of_freedom): </span><span class="si">{</span><span class="n">degrees_of_freedom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Basic Fit Information ---
Number of Observations (n): 8
Number of Parameters (p): 2
Degrees of Freedom (degrees_of_freedom): 6
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Hypothesis Testing: t-values and p-values ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Hypothesis Testing ---&quot;</span><span class="p">)</span>

<span class="c1"># Calculate t-values</span>
<span class="n">t_value_intercept</span> <span class="o">=</span> <span class="n">intercept</span> <span class="o">/</span> <span class="n">std_err_intercept</span>
<span class="n">t_value_slope</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">/</span> <span class="n">std_err_slope</span>

<span class="c1"># Calculate two-tailed p-values</span>
<span class="n">p_value_intercept</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_intercept</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">p_value_slope</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t_value_slope</span><span class="p">),</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error for Intercept: </span><span class="si">{</span><span class="n">std_err_intercept</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Intercept: </span><span class="si">{</span><span class="n">t_value_intercept</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Intercept: </span><span class="si">{</span><span class="n">p_value_intercept</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard Error for Slope: </span><span class="si">{</span><span class="n">std_err_slope</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-value for Slope: </span><span class="si">{</span><span class="n">t_value_slope</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P-value for Slope: </span><span class="si">{</span><span class="n">p_value_slope</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Hypothesis Testing ---
Standard Error for Intercept: 0.223991
T-value for Intercept: 2.846212
P-value for Intercept: 0.029327
Standard Error for Slope: 0.074481
T-value for Slope: 21.290119
P-value for Slope: 0.000001
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Sum of Squares Calculations ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Sum of Squares (SS) ---&quot;</span><span class="p">)</span>
<span class="c1"># Residual Sum of Squares (RSS)</span>
<span class="n">rss_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">rss_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weighted_residuals</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># This is also the Chi-Squared value</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Residual Sum of Squares (Weighted RSS): </span><span class="si">{</span><span class="n">rss_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Residual Sum of Squares (RSS): </span><span class="si">{</span><span class="n">rss_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Total Sum of Squares (TSS)</span>
<span class="n">weighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="n">y_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">unweighted_mean_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="n">weighted_centered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">unweighted_centered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Centered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">weighted_centered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Centered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">unweighted_centered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Uncentered Total Sum of Squares (TSS)</span>
<span class="n">weighted_uncentered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_obs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">unweighted_uncentered_tss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_obs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Uncentered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">weighted_uncentered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Uncentered Total Sum of Squares (TSS): </span><span class="si">{</span><span class="n">unweighted_uncentered_tss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Explained Sum of Squares (ESS)</span>
<span class="n">ess_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">weighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ess_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_pred</span> <span class="o">-</span> <span class="n">unweighted_mean_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Explained Sum of Squares (ESS): </span><span class="si">{</span><span class="n">ess_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Explained Sum of Squares (ESS): </span><span class="si">{</span><span class="n">ess_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Sum of Squares (SS) ---

Weighted Residual Sum of Squares (Weighted RSS): 1.8848
Unweighted Residual Sum of Squares (RSS): 0.8626

Weighted Centered Total Sum of Squares (TSS): 455.1540
Unweighted Centered Total Sum of Squares (TSS): 116.4488

Weighted Uncentered Total Sum of Squares (TSS): 1511.9919
Unweighted Uncentered Total Sum of Squares (TSS): 604.7300

Weighted Explained Sum of Squares (ESS): 453.2692
Unweighted Explained Sum of Squares (ESS): 105.6192
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Goodness-of-Fit Metrics ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Goodness-of-Fit ---&quot;</span><span class="p">)</span>

<span class="c1"># R-squared</span>
<span class="n">r_squared_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_weighted</span> <span class="o">/</span> <span class="n">weighted_centered_tss</span>
<span class="n">r_squared_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">rss_unweighted</span> <span class="o">/</span> <span class="n">unweighted_centered_tss</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted R-squared: </span><span class="si">{</span><span class="n">r_squared_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted R-squared: </span><span class="si">{</span><span class="n">r_squared_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Adjusted R-squared</span>
<span class="n">r_squared_adj_weighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_weighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="n">r_squared_adj_unweighted</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r_squared_unweighted</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unweighted Adjusted R-squared: </span><span class="si">{</span><span class="n">r_squared_adj_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Chi-Squared and Reduced Chi-Squared</span>
<span class="n">chi_squared</span> <span class="o">=</span> <span class="n">rss_weighted</span> <span class="c1"># By definition</span>
<span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">chi_squared</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Chi-Squared: </span><span class="si">{</span><span class="n">chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reduced Chi-Squared (RSS_weighted / degrees_of_freedom): </span><span class="si">{</span><span class="n">reduced_chi_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Goodness-of-Fit ---

Weighted R-squared: 0.9959
Unweighted R-squared: 0.9926

Weighted Adjusted R-squared: 0.9952
Unweighted Adjusted R-squared: 0.9914

Chi-Squared: 1.8848
Reduced Chi-Squared (RSS_weighted / degrees_of_freedom): 0.3141
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Error Metrics ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- Error Metrics ---&quot;</span><span class="p">)</span>
<span class="c1"># Root Mean Squared Error (RMSE)</span>
<span class="n">rmse_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
<span class="n">rmse_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unweighted RMSE: </span><span class="si">{</span><span class="n">rmse_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted RMSE: </span><span class="si">{</span><span class="n">rmse_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Standard Error of the Regression (SER)</span>
<span class="n">ser_unweighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_unweighted</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span>
<span class="n">ser_weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rss_weighted</span> <span class="o">/</span> <span class="n">degrees_of_freedom</span><span class="p">)</span> <span class="c1"># Same as sqrt of reduced_chi_squared</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Unweighted SER: </span><span class="si">{</span><span class="n">ser_unweighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Weighted SER: </span><span class="si">{</span><span class="n">ser_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># --- Mean Squared Errors (MSE) ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Mean Squared Errors (MSE) ---&quot;</span><span class="p">)</span>
<span class="n">mse_model_weighted</span> <span class="o">=</span> <span class="n">ess_weighted</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">mse_resid_weighted</span> <span class="o">=</span> <span class="n">rss_weighted</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="c1"># Same as reduced chi-squared</span>
<span class="n">mse_total_weighted</span> <span class="o">=</span> <span class="n">weighted_centered_tss</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Manual Weighted Mean Squared Error (MSE): </span><span class="si">{</span><span class="n">mse_model_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted Residual MSE: </span><span class="si">{</span><span class="n">mse_resid_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manual Weighted Total MSE: </span><span class="si">{</span><span class="n">mse_total_weighted</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Error Metrics ---

Unweighted RMSE: 0.3284
Weighted RMSE: 0.1869

Unweighted SER: 0.3792
Weighted SER: 0.5605

--- Mean Squared Errors (MSE) ---

Manual Weighted Mean Squared Error (MSE): 453.2692
Manual Weighted Residual MSE: 0.3141
Manual Weighted Total MSE: 65.0220
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h3>Log-Likelihood<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>In this case, standard deviations <span class="math notranslate nohighlight">\(sigma_i\)</span> are known, so we do not need to calculate Maximum Likelihood Estimate (MLE) for the variance.</p>
<p>We can use standard formula from <a class="reference internal" href="#../aic-and-bic.ipynb"><span class="xref myst">here</span></a>:</p>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \ln\left(\sqrt{2\pi\sigma_i^2}\right) - \frac{1}{2} \sum_{i=1}^{n} \frac{(y_i - f(x_i, \beta))^2}{\sigma_i^2}\]</div>
<p>Let’s simplify it a bit:</p>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \ln\left(\sqrt{2\pi\sigma_i^2}\right) - \frac{1}{2} RSS_w\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \ln\left(\sqrt{2\pi} \sigma_i \right) - \frac{1}{2} RSS_w\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \left( \ln\left(\sqrt{2\pi} \right) + \ln\left(\sigma_i \right) \right) - \frac{1}{2} RSS_w\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \sum_{i=1}^{n} \ln\left(\sqrt{2\pi} \right) - \sum_{i=1}^{n} \ln\left(\sigma_i \right) - \frac{1}{2} RSS_w\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - n \ln\left(\sqrt{2\pi} \right) - \sum_{i=1}^{n} \ln\left(\sigma_i \right) - \frac{1}{2} RSS_w\]</div>
<div class="math notranslate nohighlight">
\[\ln(L) = - \frac{n}{2} \ln\left(2\pi \right) - \sum_{i=1}^{n} \ln\left(\sigma_i \right) - \frac{1}{2} RSS_w\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Log-Likelihood and Information Criteria ---</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- Log-Likelihood &amp; Information Criteria ---&quot;</span><span class="p">)</span>
<span class="c1"># Since absolute_sigma=True, we assume sigma is known.</span>
<span class="c1"># The log-likelihood formula for a Gaussian distribution with known sigma is:</span>
<span class="c1"># L = -n/2*log(2*pi) - sum(log(sigma_i)) - 1/2 * sum(((y_i - y_pred_i)/sigma_i)^2)</span>
<span class="n">term1</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">term2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span>
<span class="n">term3</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">rss_weighted</span>
<span class="n">llf</span> <span class="o">=</span> <span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span> <span class="o">+</span> <span class="n">term3</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum Log-Likelihood: </span><span class="si">{</span><span class="n">llf</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Information Criteria</span>
<span class="n">aic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">p</span>
<span class="n">bic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">llf</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
<span class="n">aicc</span> <span class="o">=</span> <span class="n">aic</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC (Akaike Information Criterion): </span><span class="si">{</span><span class="n">aic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC (Bayesian Information Criterion): </span><span class="si">{</span><span class="n">bic</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AICc (Corrected AIC): </span><span class="si">{</span><span class="n">aicc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- Log-Likelihood &amp; Information Criteria ---
Maximum Log-Likelihood: -2.6751
AIC (Akaike Information Criterion): 9.3501
BIC (Bayesian Information Criterion): 9.5090
AICc (Corrected AIC): 11.7501
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Generate and display plots ---</span>
<span class="c1"># Create a matrix X for manual calculation of intervals</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># --- Calculate Confidence and Prediction Intervals Manually ---</span>
<span class="c1"># Critical t-value for 95% confidence</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">t_crit</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">degrees_of_freedom</span><span class="p">)</span>

<span class="c1"># 1. Confidence Interval for the mean response</span>
<span class="c1"># SE(y_hat) = sqrt(diag(X @ pcov @ X.T))</span>
<span class="n">se_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">X</span> <span class="o">@</span> <span class="n">pcov</span> <span class="o">@</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
<span class="n">ci_lower</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">-</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_mean</span>
<span class="n">ci_upper</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_mean</span>

<span class="c1"># 2. Prediction Interval for a new observation</span>
<span class="c1"># PI = y_hat +/- t * sqrt(sigma_i^2 + SE(y_hat)^2)</span>
<span class="c1"># Here sigma_i is the std dev of the individual point</span>
<span class="n">se_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">se_mean</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pi_lower</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">-</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_pred</span>
<span class="n">pi_upper</span> <span class="o">=</span> <span class="n">y_pred</span> <span class="o">+</span> <span class="n">t_crit</span> <span class="o">*</span> <span class="n">se_pred</span>

<span class="c1"># --- Plotting ---</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;WLS Regression Analysis with SciPy&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Plot 1: WLS Fit with Confidence and Prediction Intervals</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data with Error Bars&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;WLS Fit&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ci_lower</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Confidence Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ci_upper</span><span class="p">,</span> <span class="s1">&#39;g--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pi_lower</span><span class="p">,</span> <span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;95% Prediction Interval&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pi_upper</span><span class="p">,</span> <span class="s1">&#39;y:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Dependent Variable (y)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;WLS Fit with Confidence and Prediction Intervals&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot 2: Residuals Plot</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residuals (y_obs - y_pred)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Plot 3: Weighted Residuals Plot</span>
<span class="c1"># The error on the weighted residuals is 1.0 because they are normalized by sigma.</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weighted_residuals</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Independent Variable (x)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Weighted Residuals of the WLS Fit&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/93eb1556024e977cbdc5d89c59dfb4128b3368c192ffb2d177f56ecc1d24557b.png" src="../_images/93eb1556024e977cbdc5d89c59dfb4128b3368c192ffb2d177f56ecc1d24557b.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./math"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="weighted-least-squares.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Weighted Least Squares</p>
      </div>
    </a>
    <a class="right-next"
       href="weighted-least-squares-code-2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">WLS - Code Examples Part 2</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-1">Example 1</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-intercept-term-in-linear-regression">The Intercept Term in Linear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-sm-add-constant-works">How <code class="docutils literal notranslate"><span class="pre">sm.add_constant</span></code> Works</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#output-analysis">Output Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-t-statistic-t">The t-statistic (<span class="math notranslate nohighlight">\(t\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-p-value-p-t">The P-value (<span class="math notranslate nohighlight">\(P&gt;|t|\)</span>)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-confidence-interval-0-025-0-975">The Confidence Interval ([0.025 0.975])</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-results-scale-means">What <code class="docutils literal notranslate"><span class="pre">results.scale</span></code> Means</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#log-likelihood">Log-Likelihood</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-and-prediction-intervals">Confidence and Prediction Intervals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#confidence-interval-mean-ci-lower-and-mean-ci-upper">Confidence Interval: <code class="docutils literal notranslate"><span class="pre">mean_ci_lower</span></code> and <code class="docutils literal notranslate"><span class="pre">mean_ci_upper</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prediction-interval-obs-ci-lower-and-obs-ci-upper">Prediction Interval: <code class="docutils literal notranslate"><span class="pre">obs_ci_lower</span></code> and <code class="docutils literal notranslate"><span class="pre">obs_ci_upper</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comment-about-the-3rd-plot-weighted-residuals-of-the-wls-fit">Comment about the 3rd Plot (Weighted Residuals of the WLS fit)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-2">Example 2</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Output Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-3">Example 3</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-sigma-parameter">Absolute sigma parameter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-sigma-false"><code class="docutils literal notranslate"><span class="pre">absolute_sigma=False</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#absolute-sigma-true"><code class="docutils literal notranslate"><span class="pre">absolute_sigma=True</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Log-Likelihood</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Vladyslav Yakovliev (Ukraine)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>